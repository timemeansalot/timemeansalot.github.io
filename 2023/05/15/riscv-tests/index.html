<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"timemeansalot.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="RISC-V å¤„ç†å™¨éªŒè¯">
<meta property="og:type" content="article">
<meta property="og:title" content="RISC-Væµ‹è¯•">
<meta property="og:url" content="http://timemeansalot.github.io/2023/05/15/riscv-tests/index.html">
<meta property="og:site_name" content="timemeansalot">
<meta property="og:description" content="RISC-V å¤„ç†å™¨éªŒè¯">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/05/19/trjTgvokFKhSi8V.png">
<meta property="og:image" content="https://s2.loli.net/2023/05/25/TcrkZPS9DbLeV8h.png">
<meta property="og:image" content="https://s2.loli.net/2023/07/01/5cs8iLybhG2EkKN.png">
<meta property="og:image" content="https://s2.loli.net/2023/07/01/8Nzq52hxLsHiEPG.png">
<meta property="og:image" content="https://s2.loli.net/2023/07/01/7wnKtoasHJedq6G.png">
<meta property="og:image" content="http://timemeansalot.github.io/Pictures/typora/image-20230707211721928.png">
<meta property="og:image" content="https://s2.loli.net/2023/07/07/adIbS1DR5uxBA4r.png">
<meta property="og:image" content="https://s2.loli.net/2023/07/07/hjYRv8Ps32GOZTV.png">
<meta property="og:image" content="https://s2.loli.net/2023/07/07/QD8nlf1BTNMxYGo.png">
<meta property="og:image" content="https://s2.loli.net/2023/07/07/nmXbVy69HxjOtwJ.png">
<meta property="article:published_time" content="2023-05-15T07:30:47.000Z">
<meta property="article:modified_time" content="2024-12-22T02:09:10.098Z">
<meta property="article:author" content="FuJie">
<meta property="article:tag" content="RISC-V">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/05/19/trjTgvokFKhSi8V.png">


<link rel="canonical" href="http://timemeansalot.github.io/2023/05/15/riscv-tests/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://timemeansalot.github.io/2023/05/15/riscv-tests/","path":"2023/05/15/riscv-tests/","title":"RISC-Væµ‹è¯•"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>RISC-Væµ‹è¯• | timemeansalot</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">timemeansalot</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">åŠªåŠ›ã€å¥‹æ–—</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%99%A8%E6%A0%B8%E9%AA%8C%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.</span> <span class="nav-text">å¤„ç†å™¨æ ¸éªŒè¯çš„æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#self-check"><span class="nav-number">1.1.</span> <span class="nav-text">Self Check</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#signature-comparison"><span class="nav-number">1.2.</span> <span class="nav-text">Signature Comparison</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trace-log-comparison"><span class="nav-number">1.3.</span> <span class="nav-text">Trace Log Comparison</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#syncasync-step-and-compare"><span class="nav-number">1.4.</span> <span class="nav-text">Sync&#x2F;Async Step and Compare</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#risc-v-%E5%A4%84%E7%90%86%E5%99%A8%E9%AA%8C%E8%AF%81%E7%BB%84%E5%BB%BA"><span class="nav-number">2.</span> <span class="nav-text">RISC-V å¤„ç†å™¨éªŒè¯ç»„å»º</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8Btest-case-suite"><span class="nav-number">2.1.</span> <span class="nav-text">æµ‹è¯•ç”¨ä¾‹(Test Case Suite)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#riscv-tests"><span class="nav-number">2.1.1.</span> <span class="nav-text">riscv-tests</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#riscv-compliance"><span class="nav-number">2.1.2.</span> <span class="nav-text">riscv-compliance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#riscv-arch-test"><span class="nav-number">2.1.3.</span> <span class="nav-text">riscv-arch-test</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#imperas-test-suite"><span class="nav-number">2.1.4.</span> <span class="nav-text">ğŸŒŸğŸŒŸğŸŒŸğŸŒŸimperas test suite</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E6%B5%81%E7%94%9F%E6%88%90%E5%99%A8instruction-stream-generators"><span class="nav-number">2.2.</span> <span class="nav-text">æŒ‡ä»¤æµç”Ÿæˆå™¨(Instruction
Stream Generators)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E8%A6%86%E7%9B%96functional-coverage"><span class="nav-number">2.3.</span> <span class="nav-text">åŠŸèƒ½è¦†ç›–(Functional Coverage)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8Breference-model"><span class="nav-number">2.4.</span> <span class="nav-text">å‚è€ƒæ¨¡å‹(reference model)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.5.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#soc-%E5%90%8E%E7%BB%AD%E6%B5%8B%E8%AF%95"><span class="nav-number">3.</span> <span class="nav-text">SoC åç»­æµ‹è¯•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E6%80%A7%E9%AA%8C%E8%AF%81"><span class="nav-number">3.1.</span> <span class="nav-text">åŠŸèƒ½æ€§éªŒè¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%BF%E7%BA%A7%E9%AA%8C%E8%AF%81"><span class="nav-number">3.2.</span> <span class="nav-text">æ¿çº§éªŒè¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E5%BA%8F%E9%9D%A2%E7%A7%AF%E5%8A%9F%E8%80%97"><span class="nav-number">3.3.</span> <span class="nav-text">æ—¶åºã€é¢ç§¯ã€åŠŸè€—</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#riscv-tests-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">4.</span> <span class="nav-text">riscv-tests ç¯å¢ƒæ­å»º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8-verilog-%E7%BC%96%E5%86%99%E7%9A%84-risc-v-%E5%A4%84%E7%90%86%E5%99%A8%E6%8E%A5%E5%85%A5%E5%88%B0-difftest-%E6%A1%86%E6%9E%B6"><span class="nav-number">5.</span> <span class="nav-text">ç”¨ Verilog
ç¼–å†™çš„ RISC-V å¤„ç†å™¨æ¥å…¥åˆ° Difftest æ¡†æ¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#difftest-%E6%8E%A5%E5%85%A5%E8%BF%87%E7%A8%8B%E5%AE%9E%E6%93%8D%E8%AE%B0%E5%BD%95"><span class="nav-number"></span> <span class="nav-text">Difftest æ¥å…¥è¿‡ç¨‹å®æ“è®°å½•</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mcu-%E6%8E%A5%E5%85%A5-difftest-%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.</span> <span class="nav-text">MCU æ¥å…¥ Difftest æ­¥éª¤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E4%B8%8D%E9%80%9A%E8%BF%87%E7%A8%8B%E5%BA%8F-abort"><span class="nav-number"></span> <span class="nav-text">è¿è¡Œä¸é€šè¿‡ï¼Œç¨‹åº abort</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%86mcu_core%E4%BB%8B%E5%85%A5difftest%E5%81%9A%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-number"></span> <span class="nav-text">å°†MCU_Coreä»‹å…¥Diffteståšçš„ä¿®æ”¹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%BE%E5%BC%83%E4%BD%BF%E7%94%A8%E9%A6%99%E5%B1%B1%E5%AE%98%E6%96%B9%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%80%E6%96%B0%E7%9A%84difftest%E7%89%88%E6%9C%AC"><span class="nav-number">1.</span> <span class="nav-text">æ”¾å¼ƒä½¿ç”¨é¦™å±±å®˜æ–¹æä¾›çš„æœ€æ–°çš„Difftestç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E5%85%A5difftest%E6%A1%86%E6%9E%B6%E5%81%9A%E7%9A%84%E4%BF%AE%E6%94%B9"><span class="nav-number">2.</span> <span class="nav-text">æ¥å…¥Difftestæ¡†æ¶åšçš„ä¿®æ”¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mcu_core%E6%8E%A5%E5%85%A5difftest%E7%BB%93%E6%9E%9C"><span class="nav-number">3.</span> <span class="nav-text">MCU_Coreæ¥å…¥Difftestç»“æœ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#references"><span class="nav-number">4.</span> <span class="nav-text">References</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="FuJie"
      src="https://s2.ax1x.com/2019/03/19/AuQxUJ.jpg">
  <p class="site-author-name" itemprop="name">FuJie</p>
  <div class="site-description" itemprop="description">èŠ±ä¸›æ‰æœ‰èœœèœ‚ï¼Œç²ªå‘åªæœ‰è‹è‡</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/timemeansalot" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;timemeansalot" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/timemeansalot@gmail.com" title="E-Mail â†’ timemeansalot@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://timemeansalot.github.io/2023/05/15/riscv-tests/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s2.ax1x.com/2019/03/19/AuQxUJ.jpg">
      <meta itemprop="name" content="FuJie">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="timemeansalot">
      <meta itemprop="description" content="èŠ±ä¸›æ‰æœ‰èœœèœ‚ï¼Œç²ªå‘åªæœ‰è‹è‡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="RISC-Væµ‹è¯• | timemeansalot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RISC-Væµ‹è¯•
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-05-15 15:30:47" itemprop="dateCreated datePublished" datetime="2023-05-15T15:30:47+08:00">2023-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-12-22 10:09:10" itemprop="dateModified" datetime="2024-12-22T10:09:10+08:00">2024-12-22</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>22k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>20 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>RISC-V å¤„ç†å™¨éªŒè¯</p>
<span id="more"></span>
<p>[TOC]</p>
<h2 id="å¤„ç†å™¨æ ¸éªŒè¯çš„æ–¹æ³•">å¤„ç†å™¨æ ¸éªŒè¯çš„æ–¹æ³•</h2>
<ol type="1">
<li>éªŒè¯ç›®æ ‡ï¼šéªŒè¯å¤„ç†å™¨å¾®æ¶æ„è®¾è®¡ï¼Œæ˜¯å¦ç¬¦åˆ RISC-V
æ‰‹å†Œçš„è§„èŒƒï¼Œä¿è¯å¤„ç†å™¨çš„è¡Œä¸ºç¬¦åˆ RISC-V å®šä¹‰</li>
<li>éªŒè¯æ–¹æ³•ï¼ˆä»ç®€å•åˆ°å¤æ‚ï¼‰ï¼šSelf Check, Signature Comparison, Trace
Log Comparison, Step and Compare</li>
</ol>
<h3 id="self-check">Self Check</h3>
<ol type="1">
<li>éªŒè¯æ–¹æ³•ï¼šæµ‹è¯•æ¿€åŠ±å†…åŒ…å«äº†æµ‹è¯•çš„æ­£ç¡®ç­”æ¡ˆï¼Œå¦‚æœ DUT(Device Under
Test) çš„è¿è¡Œç»“æœåŒ¹é…äº‰å–ç­”æ¡ˆï¼Œåˆ™æµ‹è¯•é€šè¿‡ï¼Œå¦åˆ™ä¸é€šè¿‡<br />
å…¸å‹çš„ä»£è¡¨æ˜¯ï¼š<strong><a
target="_blank" rel="noopener" href="https://github.com/riscv-software-src/riscv-tests">riscv-tests</a></strong>
, ç¼–å†™å®šé‡æŒ‡ä»¤ç éªŒè¯å†…æ ¸çš„åŠŸèƒ½ï¼Œ
<ul>
<li>åŒ…æ‹¬å„ç±»æŒ‡ä»¤çš„é€»è¾‘åŠŸèƒ½</li>
<li>æ•°æ®å†’é™©</li>
<li>åˆ†æ”¯è·³è½¬</li>
<li>æµæ°´çº¿åˆ·æ–°(refresh)ã€æš‚åœ(stall)</li>
<li>CSR æŒ‡ä»¤</li>
</ul></li>
<li>ä¼˜ç‚¹ï¼š
<ul>
<li>æœ€ç®€å•å®ç°ï¼šæµ‹è¯•çš„ assmbly æ–‡ä»¶ç¼–å†™ç®€å•</li>
<li>è¿è¡Œæ–¹å¼æœ€ç®€å•ï¼šåªéœ€è¦å°† assmbly æ–‡ä»¶ç¼–è¯‘å¾—åˆ°æœºå™¨ç ï¼ŒåŠ è½½åˆ°
testbench ä¸­è¿è¡Œ</li>
<li>è¿è¡Œç»“æœæœ€ç®€å•ï¼šåªæœ‰æ­£ç¡®å’Œé”™è¯¯ä¸¤ç§ç»“æœ</li>
</ul></li>
<li>ç¼ºç‚¹ï¼š
<ul>
<li>æ¶‰åŠåˆ°çš„ DUT å†…éƒ¨å˜é‡ã€çŠ¶æ€æœ€å°‘</li>
<li>æ­£ç¡®ç­”æ¡ˆã€é”™è¯¯è¿‡ç¨‹ï¼šDUT
æ˜¯é”™è¯¯çš„ï¼Œä½†æ˜¯å¾—åˆ°äº†è·Ÿæ­£ç¡®ç­”æ¡ˆä¸€æ ·çš„ç»“æœ</li>
</ul></li>
<li>Self Check ä¸¾ä¾‹:</li>
</ol>
<h3 id="signature-comparison">Signature Comparison</h3>
<ol type="1">
<li>éªŒè¯æ–¹æ³•ï¼š
<ul>
<li>Self Check çš„æ”¹è¿›</li>
<li>å¯ä»¥åœ¨å…³é”®æ—¶åˆ»è®°å½•å†…éƒ¨å˜é‡çš„ä¿¡æ¯åˆ° Signature ä¸­ï¼Œå°†è¯¥ Signature
ä¸å‚è€ƒçš„æ¯”è¾ƒæ¥åˆ¤æ–­ DUT çš„åŠŸèƒ½<br />
å…¸å‹çš„ä»£è¡¨æ˜¯ï¼š<strong><a
target="_blank" rel="noopener" href="https://github.com/lowRISC/riscv-compliance/blob/master/doc/README.adoc">riscv-compliance</a></strong></li>
<li>å¯ä»¥å®ŒæˆåŸºç¡€çš„åŠŸèƒ½æ€§æµ‹è¯•</li>
</ul></li>
<li>ä¼˜ç‚¹ï¼š
<ul>
<li>ç›¸æ¯” Self Check åœ¨éªŒè¯çš„æ—¶å€™ï¼Œå¯ä»¥æš´éœ²æ›´å¤šå†…éƒ¨çš„ä¿¡æ¯</li>
</ul></li>
<li>ç¼ºç‚¹ï¼š
<ul>
<li>æš´éœ²çš„ DUT å†…éƒ¨ä¿¡æ¯ã€çŠ¶æ€ä¹Ÿæ˜¯æœ‰é™çš„</li>
</ul></li>
<li>Signature Comparison ä¸¾ä¾‹:</li>
</ol>
<h3 id="trace-log-comparison">Trace Log Comparison</h3>
<ol type="1">
<li>éªŒè¯æ–¹æ³•ï¼š
<ul>
<li>ä¸ reference-model è¿›è¡Œå¯¹æ¯”æ¥éªŒè¯ DUT çš„åŠŸèƒ½</li>
<li>å°†æµ‹è¯•ç”¨ä¾‹ç¼–è¯‘ï¼Œä½œä¸ºè¾“å…¥åŒæ—¶ç»™åˆ° DUT å’Œ reference-modelï¼Œ
è¿è¡Œçš„æ—¶å€™åˆ†åˆ«è®°å½• DUT å’Œ reference-model çš„å†…éƒ¨ä¿¡æ¯åˆ° trace æ–‡ä»¶ä¸­</li>
<li>ä»¿çœŸå®Œæˆä¹‹åï¼šå°†äºŒè€…çš„ trace
æ–‡ä»¶è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœåŒ¹é…åˆ™è¡¨ç¤ºéªŒè¯é€šè¿‡</li>
</ul></li>
<li>ä¼˜ç‚¹ï¼š
<ul>
<li>éªŒè¯çš„æ—¶å€™ä¼šè®°å½•å¤§é‡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¦‚ï¼šå…·ä½“æŒ‡ä»¤ã€å¯„å­˜å™¨ä¿¡æ¯ã€å¤„ç†å™¨çŠ¶æ€ä¿¡æ¯ç­‰</li>
<li>ç”±äºè·Ÿ reference-model
åšå¯¹æ¯”ï¼Œå› æ­¤æ¯ä¸ªæµ‹è¯•å‘é‡çš„æ­£ç¡®ç­”æ¡ˆä¸ç”¨çŸ¥é“ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ ISG(instruction
Sequence Generator) æ¥ç”Ÿæˆéšæœºçš„æµ‹è¯•å‘é‡</li>
</ul></li>
<li>ç¼ºç‚¹ï¼š
<ul>
<li>å¯¹äºå¼‚æ­¥äº‹ä»¶ï¼Œå¾ˆéš¾åšåˆ° DUT å’Œ reference-model
ä¸€è‡´ï¼Œå¦‚ï¼šä¸­æ–­ã€è°ƒè¯•ã€æµæ°´çº¿æš‚åœç­‰</li>
<li>æ—¶é—´é•¿ï¼šéœ€è¦å®Œæˆæ‰€æœ‰ä»¿çœŸä¹‹åï¼Œå†å¯¹ trace æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒ</li>
<li>ä»¿çœŸçš„ trace æ–‡ä»¶ä¼šå¾ˆå¤§</li>
<li>è·‘é£(runaway execution)</li>
</ul></li>
<li>Trace Log Comparison ä¸¾ä¾‹:</li>
</ol>
<h3 id="syncasync-step-and-compare">Sync/Async Step and Compare</h3>
<ol type="1">
<li>éªŒè¯æ–¹æ³•ï¼š
<ul>
<li><strong>ä¸šç•Œè´¨é‡æœ€é«˜ã€æœ€é«˜æ•ˆçš„</strong>éªŒè¯æ–¹æ³•</li>
<li>åœ¨ Trace Log Comparison çš„åŸºç¡€ä¸Šï¼Œå°†æ¯”è¾ƒçš„è¿‡ç¨‹æ”¾åˆ°äº†ä»¿çœŸé‡Œ</li>
<li>æ¯ä¸€æ­¥éƒ½ä¼šå°† DUT è·Ÿ reference-model
è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸åŒ¹é…ä¼šç›´æ¥æŠ¥é”™</li>
</ul></li>
<li>ä¼˜ç‚¹ï¼š
<ul>
<li>éªŒè¯çš„æ—¶å€™ä¼šè®°å½•å¤§é‡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¦‚ï¼šå…·ä½“æŒ‡ä»¤, GPR, CSR,
å’Œå…¶ä»–å†…éƒ¨ä¿¡æ¯ç­‰</li>
<li>åœ¨ä»¿çœŸçš„æ—¶å€™æ¯ä¸ª cycle
éƒ½å¯ä»¥æ¯”è¾ƒäºŒè€…çš„å†…éƒ¨çŠ¶æ€ï¼Œä¸éœ€è¦å­˜å‚¨ä»¿çœŸçš„ç»“æœåˆ°æ–‡ä»¶</li>
<li>å½“å¼‚æ­¥äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å¯¹ DUT è·Ÿ reference-model è¿›è¡Œæ¯”è¾ƒ</li>
<li>å½“å‘ç°ä»¿çœŸç»“æœåŒ¹é…ä¸ä¸Šçš„æ—¶å€™ï¼Œä¼šç«‹åˆ»ç»“æŸä»¿çœŸ,
èƒ½å¤Ÿå¿«é€Ÿçš„æŠ¥å‘Šé”™è¯¯</li>
</ul></li>
<li>ç¼ºç‚¹ï¼š
<ul>
<li>å®ç°çš„å¤æ‚åº¦å¾ˆé«˜ï¼Œéœ€è¦å¤„ç†å¼‚æ­¥äº‹ä»¶å‘ç”Ÿæ—¶ DUT å’Œ reference-model
ä¹‹é—´çš„åŒæ­¥</li>
</ul></li>
<li>Step and Compare ä¸¾ä¾‹: <img
src="https://s2.loli.net/2023/05/19/y6BxWXvJ7dhOkle.webp"
alt="Imperas Open Verification to RISC-V" /></li>
</ol>
<h2 id="risc-v-å¤„ç†å™¨éªŒè¯ç»„å»º">RISC-V å¤„ç†å™¨éªŒè¯ç»„å»º</h2>
<figure>
<img src="https://s2.loli.net/2023/05/19/trjTgvokFKhSi8V.png"
alt="test bench components" />
<figcaption aria-hidden="true">test bench components</figcaption>
</figure>
<h3 id="æµ‹è¯•ç”¨ä¾‹test-case-suite">æµ‹è¯•ç”¨ä¾‹(Test Case Suite)</h3>
<h4 id="riscv-tests">riscv-tests</h4>
<ol type="1">
<li><p>RISC-V åŸºé‡‘ä¼šæä¾›äº†ä¸€ç»„å¼€æºçš„æµ‹è¯•å®ä¾‹ riscv-testsï¼Œç”¨äºæµ‹è¯•
RISC-V å¤„ç†å™¨çš„æŒ‡ä»¤åŠŸèƒ½</p></li>
<li><p>riscv-tests
ä¸­çš„æµ‹è¯•ç¨‹åºç”±æ±‡ç¼–è¯­è¨€ç¼–å†™ï¼Œå¯ç”±ç”¨æˆ·è‡ªè¡Œé€‰æ‹©æµ‹è¯•è¦†ç›–çš„æŒ‡ä»¤é›†</p></li>
<li><p>æµ‹è¯•åŸç†ï¼š</p>
<ul>
<li>ç”±å¤„ç†å™¨è¿è¡ŒæŒ‡ä»¤çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶å°†æ¯ä¸€æ­¥è¿è¡Œç»“æœä¸é¢„æœŸç»“æœå¯¹æ¯”</li>
<li>å¦‚æœå¯¹æ¯”ç»“æœä¸åŒï¼Œåˆ™ TestBench
æ§åˆ¶å¤„ç†å™¨è·³è½¬è‡³å¼‚å¸¸åœ°å€ï¼Œåœæ­¢æ‰§è¡Œç¨‹åºï¼Œå¹¶åœ¨ç»ˆç«¯æ‰“å° FAIL</li>
<li>å¦‚æœå¯¹æ¯”ç»“æœç›¸åŒï¼Œåˆ™å¤„ç†å™¨ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œç›´åˆ°æ‰€æœ‰æŒ‡ä»¤æ‰§è¡Œç»“æŸï¼ŒTestBench
åœ¨ç»ˆç«¯æ‰“å° PASS</li>
</ul></li>
<li><p>æµ‹è¯•çš„åŸºæœ¬æ¡†æ¶ï¼š</p>
<ul>
<li>æ‰€æœ‰çš„æµ‹è¯•æ¿€åŠ±éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„å…¥å£åœ°å€ï¼Œåœ¨ riscv-tests é‡Œæ˜¯
0x800000000</li>
<li>ä» 0x800000000 ä¼šè·³åˆ° reset_vector
åœ°å€ï¼Œå®Œæˆå†…éƒ¨å¯„å­˜å™¨çš„åˆå§‹åŒ–ã€å¤„ç†å™¨çŠ¶æ€çš„åˆå§‹åŒ–</li>
<li>åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œè°ƒç”¨ mretï¼Œè·³è½¬åˆ°ç¬¬ä¸€ä¸ª test case åœ°å€å¼€å§‹æµ‹è¯•</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">rv32ui-p-add:     file format elf32-littleriscv</span><br><span class="line"></span><br><span class="line">Disassembly of section .text.init:</span><br><span class="line"></span><br><span class="line">80000000 &lt;_start&gt;:</span><br><span class="line">80000000:	0500006f          	j	80000050 &lt;reset_vector&gt;</span><br><span class="line">...</span><br><span class="line">80000050 &lt;reset_vector&gt;:</span><br><span class="line">80000050:	00000093          	li	ra,0</span><br><span class="line">80000054:	00000113          	li	sp,0</span><br><span class="line">...</span><br><span class="line">8000017c:	01428293          	add	t0,t0,20  8000018c &lt;test_2&gt;</span><br><span class="line">80000180:	34129073          	csrw	mepc,t0</span><br><span class="line">80000184:	f1402573          	csrr	a0,mhartid</span><br><span class="line">80000188:	30200073          	mret   è·³åˆ°mepcåœ°å€ï¼Œ80000018C</span><br><span class="line"></span><br><span class="line">8000018c &lt;test_2&gt;:</span><br><span class="line">8000018c:	00200193          	li	gp,2</span><br><span class="line">80000190:	00000093          	li	ra,0</span><br><span class="line">80000194:	00000113          	li	sp,0</span><br><span class="line">80000198:	00208733          	add	a4,ra,sp</span><br><span class="line">8000019c:	00000393          	li	t2,0</span><br><span class="line">800001a0:	4c771663          	bne	a4,t2,8000066c &lt;fail&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>ä¾‹ï¼šriscv-tests ä¸­å¯¹ <code>ADD</code> æŒ‡ä»¤æµ‹è¯•ä¸‰éƒ¨åˆ†åŠŸèƒ½ï¼š</p>
<ul>
<li><p>asm test source file:</p>
<ul>
<li>åŠ æ³•æ“ä½œæ­£ç¡®æ€§</li>
<li>æº/ç›®çš„å¯„å­˜å™¨æµ‹è¯•</li>
<li>bypass</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> file: rv32ui-p-add.S</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"> Arithmetic tests</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">TEST_RR_OP( 2,  add, 0x00000000, 0x00000000, 0x00000000 );</span><br><span class="line">TEST_RR_OP( 3,  add, 0x00000002, 0x00000001, 0x00000001 );</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"> Source/Destination tests</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">TEST_RR_SRC1_EQ_DEST( 17, add, 24, 13, 11 );</span><br><span class="line">TEST_RR_SRC2_EQ_DEST( 18, add, 25, 14, 11 );</span><br><span class="line">TEST_RR_SRC12_EQ_DEST( 19, add, 26, 13 );</span><br><span class="line">....</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"> Bypassing tests</span><br><span class="line">-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">TEST_RR_DEST_BYPASS( 20, 0, add, 24, 13, 11 );</span><br><span class="line">TEST_RR_DEST_BYPASS( 21, 1, add, 25, 14, 11 );</span><br><span class="line">TEST_RR_DEST_BYPASS( 22, 2, add, 26, 15, 11 );</span><br><span class="line">...</span><br><span class="line">TEST_RR_ZERODEST( 38, add, 16, 30 );</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> file: test_macros.h</span><br><span class="line">define TEST_CASE( testnum, testreg, correctval, code... ) \</span><br><span class="line">    test_ ## testnum: \</span><br><span class="line">        li  TESTNUM, testnum; \</span><br><span class="line">        code; \</span><br><span class="line">        li  x7, MASK_XLEN(correctval); \</span><br><span class="line">        bne testreg, x7, fail;</span><br><span class="line"></span><br><span class="line">define TEST_RR_OP( testnum, inst, result, val1, val2 ) \</span><br><span class="line">    TEST_CASE( testnum, x14, result, \</span><br><span class="line">      li  x1, MASK_XLEN(val1); \</span><br><span class="line">      li  x2, MASK_XLEN(val2); \</span><br><span class="line">      inst x14, x1, x2; \</span><br><span class="line"></span><br><span class="line">define RVTEST_FAIL                                                     \</span><br><span class="line">     fence;                                                          \</span><br><span class="line">     1:      beqz TESTNUM, 1b;                                               \</span><br><span class="line">     sll TESTNUM, TESTNUM, 1;                                        \</span><br><span class="line">     or TESTNUM, TESTNUM, 1;                                         \</span><br><span class="line">     li a7, 93;                                                      \</span><br><span class="line">     addi a0, TESTNUM, 0;                                            \</span><br><span class="line">     ecall</span><br></pre></td></tr></table></figure></li>
<li><p>compile the asm file and get dump file</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> file: rv32ui-p-add.dump</span><br><span class="line"> init system like reset RF, set trap vectors</span><br><span class="line">...</span><br><span class="line"> test codes</span><br><span class="line">## add test</span><br><span class="line">8000018c &lt;test_2&gt;:</span><br><span class="line">8000018c:	00200193          	li	gp,2</span><br><span class="line">80000190:	00000093          	li	ra,0</span><br><span class="line">80000194:	00000113          	li	sp,0</span><br><span class="line">80000198:	00208733          	add	a4,ra,sp</span><br><span class="line">8000019c:	00000393          	li	t2,0</span><br><span class="line">800001a0:	4c771663          	bne	a4,t2,8000066c &lt;fail&gt;</span><br><span class="line">...</span><br><span class="line">## source/destination test</span><br><span class="line">80000324 &lt;test_17&gt;:</span><br><span class="line">80000324:	01100193          	li	gp,17</span><br><span class="line">80000328:	00d00093          	li	ra,13</span><br><span class="line">8000032c:	00b00113          	li	sp,11</span><br><span class="line">80000330:	002080b3          	add	ra,ra,sp</span><br><span class="line">80000334:	01800393          	li	t2,24</span><br><span class="line">80000338:	32709a63          	bne	ra,t2,8000066c &lt;fail&gt;</span><br><span class="line">...</span><br><span class="line">## bypass test</span><br><span class="line">80000368 &lt;test_20&gt;:</span><br><span class="line">80000368:	01400193          	li	gp,20</span><br><span class="line">8000036c:	00000213          	li	tp,0</span><br><span class="line">80000370:	00d00093          	li	ra,13</span><br><span class="line">80000374:	00b00113          	li	sp,11</span><br><span class="line">80000378:	00208733          	add	a4,ra,sp</span><br><span class="line">8000037c:	00070313          	mv	t1,a4</span><br><span class="line">80000380:	00120213          	add	tp,tp,1  1 &lt;_start-0x7fffffff&gt;</span><br><span class="line">80000384:	00200293          	li	t0,2</span><br><span class="line">80000388:	fe5214e3          	bne	tp,t0,80000370 &lt;test_20+0x8&gt;</span><br><span class="line">8000038c:	01800393          	li	t2,24</span><br><span class="line">80000390:	2c731e63          	bne	t1,t2,8000066c &lt;fail&gt;</span><br><span class="line"></span><br><span class="line"> test fail operations</span><br><span class="line">8000066c &lt;fail&gt;:</span><br><span class="line">8000066c:	0ff0000f          	fence</span><br><span class="line">80000670:	00018063          	beqz	gp,80000670 &lt;fail+0x4&gt;</span><br><span class="line">80000674:	00119193          	sll	gp,gp,0x1</span><br><span class="line">80000678:	0011e193          	or	gp,gp,1</span><br><span class="line">8000067c:	05d00893          	li	a7,93</span><br><span class="line">80000680:	00018513          	mv	a0,gp</span><br><span class="line">80000684:	00000073          	ecall</span><br><span class="line"> all test pass operations</span><br><span class="line">80000688 &lt;pass&gt;:</span><br><span class="line">80000688:	0ff0000f          	fence</span><br><span class="line">8000068c:	00100193          	li	gp,1  all test fass, set x3 to 1</span><br><span class="line">80000690:	05d00893          	li	a7,93</span><br><span class="line">80000694:	00000513          	li	a0,0</span><br><span class="line">80000698:	00000073          	ecall</span><br><span class="line">8000069c:	c0001073          	unimp</span><br></pre></td></tr></table></figure></li>
<li><p>test bench output å¦‚æœæµ‹è¯•ä¸é€šè¿‡ï¼Œä¼šæ˜¾ç¤ºä¸é€šè¿‡çš„æµ‹è¯•
caseï¼Œ<code>case=x3&gt;&gt;1</code> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~ Test Result Summary ~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~TESTCASE:/Users/fujie/Desktop/Developer/git_repos/hbird/e203_hbirdv2/vsim/run/../../riscv-tools/riscv-tests/isa/generated/rv32ui-p-add ~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~Total cycle_count value:      23205 ~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~The valid Instruction Count:      14117 ~~~~~~~~~~~~~</span><br><span class="line">~~~~~The test ending reached at cycle:      23165 ~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~The final x3 Reg value:          7 ~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~~ TEST_FAIL ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~######    ##       #    #     ~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~        ##  #      #    #     ~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~#####   #    #     #    #     ~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~       #######     #    #     ~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~       ##    #     #    #     ~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~       ##    #     #    ######~~~~~~~~~~~~~~~~</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br></pre></td></tr></table></figure></p></li>
</ul></li>
</ol>
<h4 id="riscv-compliance">riscv-compliance</h4>
<p><a
target="_blank" rel="noopener" href="https://github.com/lowRISC/riscv-compliance/blob/master/doc/README.adocintroduction">riscv-compliance</a>
çš„ç›®æ ‡æ˜¯æ£€æŸ¥æ­£åœ¨å¼€å‘çš„å¤„ç†å™¨æ˜¯å¦ç¬¦åˆå¼€æ”¾çš„ RISC-V æ ‡å‡†ã€‚ é€šè¿‡äº†
riscv-compliance çš„è®¾è®¡ï¼Œå¯ä»¥è¢«å£°æ˜ä¸º<u>RISC-V compliant</u> <img
src="https://s2.loli.net/2023/05/19/mpz6BZsoAC152VN.png"
alt="riscv-compliance" /></p>
<ol type="1">
<li>é€‰å®šäº†æµ‹è¯•é›†ä¹‹åå¯ä»¥ç¼–è¯‘å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>åœ¨ DUT
ä¸­æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»¿çœŸçš„æ—¶å€™ä¼šæŠŠå†…éƒ¨å˜é‡å†™åˆ°æŸä¸ªå†…å­˜ä¸­ï¼Œä»¿çœŸç»“æŸä¹‹åï¼Œä¼šæŠŠå†…å­˜é‡Œçš„æ•°æ®
dump åˆ°æ–‡ä»¶ï¼Œå¾—åˆ°ä»¿çœŸçš„ signatures</li>
<li>å°† signatures è·Ÿæ­£ç¡®çš„ signatures æ¯”è¾ƒï¼Œå¦‚æœé€šè¿‡äº†åˆ™ä»£è¡¨ DUT
é€šè¿‡æµ‹è¯•</li>
<li>ä»¿çœŸç»“æŸå¯ä»¥å¾—åˆ° Coverage Report</li>
</ol>
<h4 id="riscv-arch-test">riscv-arch-test</h4>
<p><a
target="_blank" rel="noopener" href="https://github.com/riscv-non-isa/riscv-arch-test">riscv-arch-test</a>
æ˜¯æŒ‰ç…§ RISC-V æŒ‡ä»¤é›†æ¨¡å—åŒ–åˆ†ç±»äº†çš„ä¸€ä¸ªæµ‹è¯•é›†</p>
<ol type="1">
<li>å…¶æµ‹è¯•é›†æ˜¯ç”±<a
target="_blank" rel="noopener" href="https://github.com/riscv/riscv-ctg">Compatibility Test Generator
from InCore Semiconductors</a>ç”Ÿæˆçš„</li>
<li>å‚è€ƒçš„ signatures æ˜¯æœ‰ spike ä»¿çœŸå¾—åˆ°çš„</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ env                        contains the architectural test header files</span><br><span class="line">â””â”€â”€ rv32i_m                    top level folder indicate rv32 tests for machine mode</span><br><span class="line">    â”œâ”€â”€ C                      include tests and references for &quot;C&quot; extension</span><br><span class="line">    â”‚Â Â  â””â”€â”€ src                assembly tests for &quot;C&quot; extension</span><br><span class="line">    â”œâ”€â”€ F                      include tests and references for &quot;rv32F&quot; extension</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ references         static references signatures for &quot;rv32F&quot; extension</span><br><span class="line">    â”‚Â Â  â””â”€â”€ src                assembly tests for &quot;rv32F&quot; extension</span><br><span class="line">    â”œâ”€â”€ I                      include tests and references for &quot;I&quot; extension</span><br><span class="line">    â”‚Â Â  â””â”€â”€ src                assembly tests for &quot;I&quot; extension</span><br><span class="line">    â”œâ”€â”€ M                      include tests and references for &quot;M&quot; extension</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for &quot;M&quot; extension</span><br><span class="line">    â”œâ”€â”€ K_unratified           include tests and references for &quot;K&quot; extension</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for &quot;K&quot; extension</span><br><span class="line">    â”œâ”€â”€ P_unratified           include tests and references for &quot;P&quot; extension</span><br><span class="line">    â”‚   â”œâ”€â”€ references         static references signatures for &quot;P&quot; extension</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for &quot;P&quot; extension</span><br><span class="line">    â”œâ”€â”€ privilege              include tests and references for tests which require Privilege Spec</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for tests which require Privilege Spec</span><br><span class="line">    â””â”€â”€ Zifencei               include tests and references for &quot;Zifencei&quot; extension</span><br><span class="line">        â””â”€â”€ src                assembly tests for &quot;Zifencei&quot; extension</span><br><span class="line">â””â”€â”€ rv64i_m                    top level folder indicate rv64 tests for machine mode</span><br><span class="line">    â”œâ”€â”€ C                      include tests and references for &quot;C&quot; extension</span><br><span class="line">    â”‚Â Â  â””â”€â”€ src                assembly tests for &quot;C&quot; extension</span><br><span class="line">    â”œâ”€â”€ I                      include tests and references for &quot;I&quot; extension</span><br><span class="line">    â”‚Â Â  â””â”€â”€ src                assembly tests for &quot;I&quot; extension</span><br><span class="line">    â”œâ”€â”€ M                      include tests and references for &quot;M&quot; extension</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for &quot;M&quot; extension</span><br><span class="line">    â”œâ”€â”€ K_unratified           include tests and references for &quot;K&quot; extension</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for &quot;K&quot; extension</span><br><span class="line">    â”œâ”€â”€ P_unratified           include tests and references for &quot;P&quot; extension</span><br><span class="line">    â”‚   â”œâ”€â”€ references         static references signatures for &quot;P&quot; extension</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for &quot;P&quot; extension</span><br><span class="line">    â”œâ”€â”€ privilege              include tests and references for tests which require Privilege Spec</span><br><span class="line">    â”‚   â””â”€â”€ src                assembly tests for tests which require Privilege Spec</span><br><span class="line">    â””â”€â”€ Zifencei               include tests and references for &quot;Zifencei&quot; extension</span><br><span class="line">        â””â”€â”€ src                assembly tests for &quot;Zifencei&quot; extension</span><br></pre></td></tr></table></figure>
<h4 id="imperas-test-suite">ğŸŒŸğŸŒŸğŸŒŸğŸŒŸimperas test suite</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/riscv-ovpsim/imperas-riscv-tests">imperas
test suite</a></p>
<ol type="1">
<li>é’ˆå¯¹ä¸åŒçš„æŒ‡ä»¤æ¨¡å—æä¾›äº†æµ‹è¯•é›†ï¼Œå¦‚ï¼šI,M,C,F,D,B,K,V,P</li>
<li>è‡ªå¸¦æ¨¡æ‹Ÿå™¨: riscvOVPsim simulators</li>
<li>èƒ½å¤Ÿç”Ÿæˆ Coverage Report</li>
<li>å‚è€ƒèµ„æ–™ä¸°å¯Œï¼ŒGitHub, YouTube ä¸Šèµ„æºè¾ƒå¤š</li>
</ol>
<h3
id="æŒ‡ä»¤æµç”Ÿæˆå™¨instruction-stream-generators">æŒ‡ä»¤æµç”Ÿæˆå™¨(Instruction
Stream Generators)</h3>
<ol type="1">
<li>Google <a
target="_blank" rel="noopener" href="https://github.com/chipsalliance/riscv-dv">riscv-dv</a>: è¾ƒä¸ºç¨³å®š
<ul>
<li>æ˜¯ä¸€ä¸ªåŸºäº SV/UVM çš„å¼€æºæŒ‡ä»¤ç”Ÿæˆå™¨ï¼Œç”¨äº RISC-V å¤„ç†å™¨éªŒè¯</li>
<li>æ”¯æŒçš„æŒ‡ä»¤é›†: RV32IMAFDCï¼ŒRV64IMAFDC</li>
<li>å¯ä»¥æ¨¡æ‹Ÿ illegal instruction</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://github.com/openhwgroup/force-riscv">OpenHW Group
force-riscv</a>: ä¸»è¦ç”¨äº RV64ï¼ŒRV32 æ”¯æŒæ‰å¼€å§‹</li>
</ol>
<h3 id="åŠŸèƒ½è¦†ç›–functional-coverage">åŠŸèƒ½è¦†ç›–(Functional Coverage)</h3>
<blockquote>
<p>åœ¨ä¸€å®šçš„æµ‹è¯•ç”¨ä¾‹ä¸Šå¯¹ DUT è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä¸”æµ‹è¯•é€šè¿‡ï¼Œåªèƒ½è¯´æ˜ DUT
åœ¨è¿™äº›æµ‹è¯•ç”¨ä¾‹ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œ å¹¶ä¸èƒ½ 100%è¯´æ˜ DUT åŠŸèƒ½å°±æ˜¯æ­£ç¡®ã€‚ ä¸ºäº†
100%è¯´æ˜ DUT åŠŸèƒ½æ˜¯æ­£ç¡®çš„ï¼Œéœ€è¦ä¿è¯æµ‹è¯• Coverage é€šè¿‡</p>
</blockquote>
<ol type="1">
<li>SystemVerilog covergroups and coverpoints</li>
<li>Imperas build-in instruction coverage</li>
</ol>
<h3 id="å‚è€ƒæ¨¡å‹reference-model">å‚è€ƒæ¨¡å‹(reference model)</h3>
<ol type="1">
<li>spike</li>
<li>qeum</li>
<li>riscvOVPsim</li>
</ol>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<ol type="1">
<li><p>å¦‚æœçŸ¥è¯†å¯¹ DUT è¿›è¡ŒåŸºæœ¬åŠŸèƒ½æµ‹è¯•ï¼Œå¯ä»¥é€‰æ‹©æŸä¸ª test suite
è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœé€šè¿‡äº†æµ‹è¯•ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯ DUT åŠŸèƒ½çš„æ­£ç¡®æ€§.</p>
<blockquote>
<p>you can never have enough tests</p>
</blockquote></li>
<li><p>å¦‚æœéœ€è¦ 100%ä¿è¯ DUT åŠŸèƒ½æ­£ç¡®ï¼Œéœ€è¦</p>
<ul>
<li>é‡‡ç”¨ asycn step and compare</li>
<li>ä¿è¯ Coverage Report ä¸­ 100%è¦†ç›–äº† check point</li>
</ul></li>
</ol>
<h2 id="soc-åç»­æµ‹è¯•">SoC åç»­æµ‹è¯•</h2>
<h3 id="åŠŸèƒ½æ€§éªŒè¯">åŠŸèƒ½æ€§éªŒè¯</h3>
<blockquote>
<p>åˆ©ç”¨<em>åŠŸèƒ½æ€§ C
ä»£ç </em>æ¥æµ‹è¯•å…·ä½“çš„åŠŸèƒ½ï¼Œå¦‚ï¼šå†…éƒ¨çœ‹é—¨ç‹—å¤ä½è¯·æ±‚ã€UART æ”¶å‘</p>
<ol type="1">
<li>åˆ©ç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„æŒ‡ä»¤ç è¿›è¡ŒéªŒè¯ï¼Œéå¸¸ç¬¦åˆå®é™…çš„è¡Œä¸º</li>
<li>ä½†éªŒè¯æ‰‹æ®µå¤æ‚ï¼Œä¸é€‚åˆä¸€å¼€å§‹ç³»ç»Ÿä¸ç¨³å®šæ—¶å€™çš„éªŒè¯</li>
</ol>
</blockquote>
<ol type="1">
<li>åˆå§‹åŒ–æ–‡ä»¶ï¼š
<ul>
<li>ç”±æ±‡ç¼–ç¼–å†™ï¼Œç³»ç»Ÿä¸Šç”µå¤ä½ä¹‹åæ‰§è¡Œçš„ç¬¬ä¸€æ®µç¨‹åº</li>
<li>å †æ ˆåˆå§‹åŒ–ã€ä¸­æ–­å‘é‡æ ‡åŠä¸­æ–­å‡½æ•°å®šä¹‰ç­‰</li>
<li>ç³»ç»Ÿå¤ä½åè¿›å…¥ main å‡½æ•°</li>
</ul></li>
<li>ç¼–å†™éœ€è¦æµ‹è¯•çš„ C æ–‡ä»¶</li>
<li>å¯¹ C æ–‡ä»¶è°ƒç”¨å·¥å…·é“¾è¿›è¡Œç¼–è¯‘ã€ä»å¯æ‰§è¡Œæ–‡ä»¶ä¸­å¾—åˆ°æœºå™¨ç ã€åœ¨ testbench
ä¸­é€šè¿‡ç³»ç»Ÿå‡½æ•°<span class="math inline">\(readmenh\)</span>åŠ è½½åˆ°
I-Memory</li>
</ol>
<h3 id="æ¿çº§éªŒè¯">æ¿çº§éªŒè¯</h3>
<blockquote>
<p>FPGA å®Œå…¨ç”±ç”¨æˆ·é€šè¿‡è¡Œé…ç½®å’Œç¼–å†™å¹¶ä¸”å¯ä»¥åå¤æ“¦å†™ï¼Œéå¸¸é€‚åˆç”¨äºåµŒå…¥å¼
SoC ç³»ç»ŸèŠ¯ç‰‡çš„åŸå‹éªŒè¯</p>
</blockquote>
<ol type="1">
<li>è®¾è®¡çš„å…¨éƒ¨ RTL ä»£ç è¿›è¡Œä¸‹æ¿, è¿›è¡Œæ¿çº§éªŒè¯</li>
<li>å¯ä»¥å‘ç°éšè—çš„æ—¶åºé—®é¢˜</li>
<li>debug: æ”¯æŒåœ¨ host ä¸Šå¯¹ MCU è¿›è¡Œè¿œç¨‹è°ƒè¯•</li>
</ol>
<h3 id="æ—¶åºé¢ç§¯åŠŸè€—">æ—¶åºã€é¢ç§¯ã€åŠŸè€—</h3>
<p>ä½¿ç”¨ DC(Design Compiler) ç»¼åˆå·¥å…·å°†å¤„ç†å™¨çš„è®¾è®¡ä»£ç è¿›è¡Œç»¼åˆï¼Œä»¥éªŒ
è¯æœ¬æ–‡æ—¶åºã€é¢ç§¯ã€åŠŸè€—çš„è®¾è®¡è¦æ±‚</p>
<ol type="1">
<li>è½¬æ¢ï¼šå°† RTL è½¬åŒ–æˆæ²¡æœ‰ä¼˜åŒ–çš„é—¨ç”µè·¯ï¼Œå¯¹äº DC ç»¼åˆå·¥å…·æ¥è¯´ï¼Œä½¿ç”¨çš„æ˜¯
gtech.db åº“ä¸­çš„é—¨çº§å•å…ƒ</li>
<li>ä¼˜åŒ–ï¼šå¯¹åˆå§‹åŒ–ç”µè·¯åˆ†æï¼Œå»æ‰å†—ä½™å•å…ƒã€å¯¹ä¸æ»¡è¶³é™åˆ¶æ¡ä»¶çš„è·¯å¾„è¿›è¡Œä¼˜åŒ–</li>
<li>æ˜ å°„ï¼šå°†ä¼˜åŒ–åçš„ç”µè·¯æ˜ å°„åˆ°åˆ¶é€ å•†æä¾›çš„å·¥è‰ºåº“ä¸Š</li>
</ol>
<p>é€šè¿‡ DC å·¥å…·ç»¼åˆåå¯ä»¥å¾—åˆ° MCU åœ¨æ—¶åºã€é¢ç§¯ã€åŠŸè€—çš„æŠ¥å‘Š</p>
<h2 id="riscv-tests-ç¯å¢ƒæ­å»º">riscv-tests ç¯å¢ƒæ­å»º</h2>
<ol type="1">
<li><p>éªŒè¯ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">â”œâ”€â”€ rtl</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ top.v</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ...</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ...</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ top_tb.v</span><br><span class="line">â””â”€â”€ verification</span><br><span class="line">    â”œâ”€â”€ Makefile</span><br><span class="line">    â”œâ”€â”€ asm</span><br><span class="line">    â””â”€â”€ rtl</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>ç›®å‰æ‰€æœ‰çš„æºæ–‡ä»¶éƒ½åœ¨é¡¹ç›®çš„<code>src</code>æ–‡ä»¶ä¸‹</li>
<li><code>src/rtl</code>å­˜æ¡£ MCU çš„ verilog ä»£ç </li>
<li><code>src/verification</code>æ˜¯ä½¿ç”¨ riscv-tests å¯¹ rtl
ä»£ç è¿›è¡ŒéªŒè¯çš„ç›®å½•
<ol type="1">
<li><code>asm</code>ï¼šå­˜æ”¾æ‰€æœ‰çš„ riscv-tests çš„æ±‡ç¼–æµ‹è¯•æ–‡ä»¶</li>
<li><code>rtl</code>ï¼šå­˜æ”¾æ‰€æœ‰çš„å¸¦æµ‹è¯•çš„ verilog æºæ–‡ä»¶</li>
<li><code>Makefile</code>ï¼šå­˜æ”¾æ‰€æœ‰éªŒè¯æ—¶éœ€è¦çš„ä¸€äº›å‘½ä»¤ï¼Œå¦‚â€œç¼–è¯‘
verilogâ€ã€â€œç¼–è¯‘æ±‡ç¼–æ–‡ä»¶â€ã€â€œä»¿çœŸâ€ç­‰</li>
</ol></li>
</ol></li>
<li><p>Makefile å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.DEFAULT_GOAL := wave</span><br><span class="line"><span class="comment"># compile asm source file to get test cases for MCU</span></span><br><span class="line"><span class="section">asmCode:</span></span><br><span class="line">	@(cd asm &amp;&amp; ./clean.sh &amp;&amp; ./regen.sh &amp;&amp; cd ..)</span><br><span class="line"><span class="comment"># copy source file before compile</span></span><br><span class="line"><span class="section">copy:</span></span><br><span class="line">	@(rm -rf rtl/*.v &amp;&amp; cp ../rtl/*.v rtl)</span><br><span class="line"><span class="comment"># simulate DUT, you&#x27;d better `make asmCode` first to generated machine code</span></span><br><span class="line"><span class="section">sim:</span></span><br><span class="line">	@(cd rtl &amp;&amp; make sim)</span><br><span class="line"><span class="comment"># show waveform</span></span><br><span class="line"><span class="section">wave:</span></span><br><span class="line">	@(cd rtl &amp;&amp; make waveform)</span><br><span class="line"></span><br><span class="line"><span class="comment"># regression test</span></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> implement in the future.</span></span><br><span class="line"><span class="comment"># Because MCU can&#x27;t pass even one test file in riscv-tests now!</span></span><br><span class="line"><span class="comment"># So we don&#x27;t need to test the whole riscv-tests now.</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	@(cd asm &amp;&amp; ./clean.sh &amp;&amp; cd ../rtl/ &amp;&amp; make clean)</span><br><span class="line"><span class="comment"># declare phone target</span></span><br><span class="line"><span class="section">PHONY: clean wave sim copy asmCode</span></span><br></pre></td></tr></table></figure>
<ol type="1">
<li>asmCode: ä¼šè¿›å…¥åˆ° asm
æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”è°ƒç”¨è„šæœ¬<code>regen.sh</code>ç¼–è¯‘æ‰€æœ‰çš„ riscv-tests
æ–‡ä»¶ï¼Œå¹¶ä¸”å¾—åˆ°æœºå™¨ç ;<br />
testbench ä¼šä»å¾—åˆ°çš„æœºå™¨ç æ–‡ä»¶ä¸­ï¼ŒåŠ è½½æŒ‡ä»¤åˆ° I-Memory ä¸­</li>
<li>copyï¼šç”¨<code>src/rtl</code>ä¸‹å¤åˆ¶æ‰€æœ‰çš„<code>.v</code>æ–‡ä»¶æ›¿æ¢<code>verification/rtl</code>ç›®å½•ä¸‹çš„æ‰€æœ‰<code>.v</code>æ–‡ä»¶</li>
<li>simï¼šä¼šè¿›å…¥<code>verification/rtl</code>ç›®å½•ä¸‹ï¼Œå¹¶ä¸”ä½¿ç”¨ make sim
å‘½ä»¤ï¼Œ è¯¥å‘½ä»¤ä¼šç¼–è¯‘ rtl æ–‡ä»¶ï¼Œå†æ‰§è¡Œ rtl ä»¿çœŸ</li>
<li>waveï¼šä½¿ç”¨ gtkWave æŸ¥çœ‹ä»¿çœŸç”Ÿæˆçš„æ³¢å½¢</li>
<li>regression test: ä½¿ç”¨æ‰€æœ‰çš„ riscv-tests æµ‹è¯•ç”¨ä¾‹æµ‹è¯• MCUï¼Œ
å¦‚æœéƒ½é€šè¿‡äº†åˆ™è¯´æ˜ MCU é€šè¿‡äº† riscv-tests æµ‹è¯•;<br />
ä½†æ˜¯ç°åœ¨çš„ MCU ä¸€ä¸ªæµ‹è¯•éƒ½æ— æ³•é€šè¿‡ï¼Œæ‰€ä»¥ç›®å‰æš‚æ—¶ä¸æ”¯æŒ regression
test.</li>
</ol></li>
<li><p>ä»¿çœŸç»“æœ riscv-tests æ±‡ç¼–æ–‡ä»¶ï¼Œé»˜è®¤æµ‹è¯•é€šè¿‡çš„æ—¶å€™ï¼Œx3 çš„å€¼ä¸º
1ï¼Œæ‰€ä»¥æ¯ä¸€è½®ä»¿çœŸç»“æŸä¹‹åï¼Œæˆ‘ä»¬åœ¨ testbench é‡Œæ£€æŸ¥ x3
çš„å€¼å°±å¯ä»¥åˆ¤æ–­æµ‹è¯•æ˜¯å¦é€šè¿‡</p>
<figure>
<img src="https://s2.loli.net/2023/05/25/TcrkZPS9DbLeV8h.png"
alt="sim fail" />
<figcaption aria-hidden="true">sim fail</figcaption>
</figure></li>
</ol>
<h2 id="ç”¨-verilog-ç¼–å†™çš„-risc-v-å¤„ç†å™¨æ¥å…¥åˆ°-difftest-æ¡†æ¶">ç”¨ Verilog
ç¼–å†™çš„ RISC-V å¤„ç†å™¨æ¥å…¥åˆ° Difftest æ¡†æ¶</h2>
<ul class="task-list">
<li><label><input type="checkbox" />æ¥å…¥ Difftest æ¡†æ¶</label>
<ul class="task-list">
<li><label><input type="checkbox" />Difftest æ¡†æ¶ä½¿ç”¨äº† AXI å’Œ UART
æ¨¡å—ï¼Œå¦‚ä½•å¿½ç•¥åˆ°è¿™äº›æ¨¡å—</label></li>
<li><label><input type="checkbox" />å¦‚ä½•åœ¨ MCU_core ä¸­ä¾‹åŒ– Difftest
æ¨¡å—ï¼Œåªå…³å¿ƒé€šç”¨å¯„å­˜å™¨çš„æ•°å€¼æ˜¯å¦åŒ¹é…</label></li>
<li><label><input type="checkbox" />å¦‚ä½•æ¯”è¾ƒ MCU_core è·Ÿ NEMU ä¸­çš„
PCï¼Ÿå› ä¸ºé‡‡ç”¨äº†æŒ‡ä»¤é¢„å–æŠ€æœ¯ï¼ŒMCU_core å¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿæ„ä¹‰çš„
PC</label></li>
<li><label><input type="checkbox" />å¦‚ä½•è§£å†³ Difftest
è¦æ±‚çš„æ—¶åºé—®é¢˜</label></li>
<li><label><input type="checkbox" />å¦‚ä½•å…·ä½“æµ‹è¯• load/store
æŒ‡ä»¤</label></li>
</ul></li>
<li><label><input type="checkbox" />ä½¿ç”¨ Difftest æ¡†æ¶è¿›è¡Œæµ‹è¯•</label>
<ul class="task-list">
<li><label><input type="checkbox" />å¦‚ä½•æ ¹æ® riscv-tests
ç”Ÿæˆæµ‹è¯•ç”¨åŠ›åŠ è½½åˆ° MCU_core ä»¥åŠ golden-modelï¼ŒNEMU é‡‡ç”¨çš„æ˜¯ 1-bank,
MCU_core é‡‡ç”¨çš„æ˜¯ 2bank I-Memory</label></li>
<li><label><input type="checkbox" />æµ‹è¯•é€šè¿‡çš„ riscv-tests</label></li>
<li><label><input type="checkbox" />æµ‹è¯•å‘ç°çš„ bugã€ä¿®æ”¹çš„
bug</label></li>
</ul></li>
</ul>
<ol type="1">
<li><p>é¡¹ç›®çš„æ¡†æ¶å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DifftestFramework</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”œâ”€â”€ nemu</span><br><span class="line">â””â”€â”€ NOOP</span><br><span class="line">    â”œâ”€â”€ difftest</span><br><span class="line">Â Â   â””â”€â”€ CPU</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Core.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Decode.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Execution.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ InstFetch.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Instructions.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Ram.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ RegFile.v</span><br><span class="line">Â Â   Â Â  â””â”€â”€ SimTop.v</span><br></pre></td></tr></table></figure>
<ul>
<li>bin: æµ‹è¯•æ–‡ä»¶</li>
<li>nemu: æŒ‡ä»¤é›†æ¨¡æ‹Ÿå™¨ï¼Œç”¨äºä½œä¸ºæ¯”è¾ƒçš„ golden model</li>
<li>difftest: é¦™å±±å›¢é˜Ÿæä¾›çš„ difftest æ¡†æ¶</li>
<li>CPU: å­˜æ”¾ MCU_core å®ç°åŠ SimTop
<ul>
<li>Core.v: MCU_core
æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é‡Œä¾‹åŒ–äº†å„ä¸ªæµæ°´çº¿éƒ¨ä»¶ã€<strong>difftest
é‡Œçš„ç»„ä»¶</strong>(å°†å¯¹åº”çš„ä¿¡å·ä¼ é€’ç»™ difftest)</li>
<li>SimTop.vï¼šdifftest æ¡†æ¶é»˜è®¤çš„é¡¶å±‚æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œéœ€è¦ä¾‹åŒ–
MCU_core</li>
</ul></li>
</ul></li>
<li><p>æµ‹è¯•æµç¨‹ï¼š</p>
<ul>
<li>åœ¨ç³»ç»Ÿç¯å¢ƒé‡ŒæŒ‡æ˜<code>NEMU_HOME</code>è·Ÿ<code>NOOP_HOME</code>ï¼ŒäºŒè€…åˆ†åˆ«åº”è¯¥è¢«è®¾ç½®ä¸º<code>NEMU</code>è·Ÿ<code>NOOP</code>çš„ç»å¯¹è·¯å¾„ï¼Œå¦‚ä¸Šè¡¨æ‰€ç¤º</li>
<li>å…‹éš† difftest éœ€è¦ç”¨åˆ°çš„å­æ¨¡å—ï¼Œdifftest æ˜¯ä» GitHub
ä¸Šå…‹éš†çš„ä»“åº“ï¼Œå…¶æœ¬èº«åŒ…å«äº†ä¸€äº›å…¶ä»–çš„ä»“åº“ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š è¿›å…¥åˆ° difftest
ç›®å½•ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤<code>git submodule update --init recursive</code>æ¥å…‹éš†æ‰€æœ‰éœ€è¦çš„å­ä»“åº“
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[submodule <span class="string">&quot;rocket-chip&quot;</span>]</span><br><span class="line">    path = rocket-chip</span><br><span class="line">    url = https://github.com/RISCVERS/rocket-chip.git</span><br><span class="line">[submodule <span class="string">&quot;block-inclusivecache-sifive&quot;</span>]</span><br><span class="line">    path = block-inclusivecache-sifive</span><br><span class="line">    url = https://github.com/RISCVERS/block-inclusivecache-sifive.git</span><br><span class="line">[submodule <span class="string">&quot;chiseltest&quot;</span>]</span><br><span class="line">    path = chiseltest</span><br><span class="line">    url = https://github.com/ucb-bar/chisel-testers2.git</span><br><span class="line">[submodule <span class="string">&quot;api-config-chipsalliance&quot;</span>]</span><br><span class="line">    path = api-config-chipsalliance</span><br><span class="line">    url = https://github.com/chipsalliance/api-config-chipsalliance</span><br><span class="line">[submodule <span class="string">&quot;berkeley-hardfloat&quot;</span>]</span><br><span class="line">    path = berkeley-hardfloat</span><br><span class="line">    url = https://github.com/RISCVERS/berkeley-hardfloat.git</span><br><span class="line">[submodule <span class="string">&quot;timingScripts&quot;</span>]</span><br><span class="line">    path = timingScripts</span><br><span class="line">    url = https://github.com/RISCVERS/timingScripts.git</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><p>åœ¨ SimTop.v æ–‡ä»¶ä¸­ï¼Œä¾‹åŒ– MCU_core</p></li>
<li><p>åœ¨ NOOP
ç›®å½•ä¸‹ï¼Œä½¿ç”¨æŒ‡ä»¤<code>make -C difftest emu</code>æ¥ç¼–è¯‘æ‰€æœ‰çš„ Verilog è·Ÿ
Scala æ–‡ä»¶ï¼Œå¾—åˆ°å¯è¿è¡Œçš„ä»¿çœŸç¨‹åºã€‚ è¯¥ä»¿çœŸç¨‹åºå°±æ˜¯<strong>æ”¯æŒå°† MCU è·Ÿ
NEMU è¿›è¡Œæ¯”è¾ƒçš„ç¨‹åº</strong>ã€‚</p>
<blockquote>
<p>PS: ç¼–è¯‘ä»¿çœŸç¨‹åºè‡³å°‘éœ€è¦ 32G çš„å†…å­˜ï¼Œå¦åˆ™ä¼šæŠ¥é”™è¯´å†…å­˜ä¸å¤Ÿ;
åœ¨æœåŠ¡å™¨ä¸Šç¼–è¯‘äº† 68 åˆ†é’Ÿ.</p>
</blockquote></li>
<li><p>ç¼–è¯‘æµ‹è¯•æ–‡ä»¶ï¼šä½¿ç”¨ riscv-tools
ç¼–è¯‘æµ‹è¯•æ–‡ä»¶ï¼Œå¾—åˆ°äºŒè¿›åˆ¶ç¨‹åº</p></li>
<li><p>ç”¨æµ‹è¯•äºŒè¿›åˆ¶ç¨‹åºä½œä¸ºè¾“å…¥ï¼Œè¿›è¡Œ
difftestã€‚ä»¿çœŸç¨‹åºä¼šåœ¨åŒ¹é…å¤±è´¥çš„æ—¶å€™ï¼ŒæŠ¥é”™å¹¶ä¸”ç»™å‡ºæŠ¥é”™çš„ä¿¡æ¯ã€‚</p></li>
</ol>
<h1 id="difftest-æ¥å…¥è¿‡ç¨‹å®æ“è®°å½•">Difftest æ¥å…¥è¿‡ç¨‹å®æ“è®°å½•</h1>
<blockquote>
<p>DIFFTEST çš„æ¯”å¯¹å¯¹è±¡æ˜¯ä¸¤ä¸ªæ ¸ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·è®¾è®¡çš„æ ¸ï¼Œä¸€ä¸ªæ˜¯å‚è€ƒæ ¸ã€‚
æ¯”å¯¹åŸç†æ˜¯è®¾è®¡æ ¸åœ¨æ¯æäº¤ä¸€æ¡æŒ‡ä»¤çš„åŒæ—¶ä½¿å‚è€ƒæ ¸æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ï¼Œä¹‹åæ¯”å¯¹æ‰€æœ‰çš„é€šç”¨å¯„å­˜å™¨å’Œ
csr å¯„å­˜å™¨çš„å€¼ï¼Œå¦‚æœå®Œå…¨ç›¸åŒåˆ™è®¤ä¸ºè®¾è®¡æ ¸æ‰§è¡Œæ­£ç¡®</p>
</blockquote>
<h2 id="mcu-æ¥å…¥-difftest-æ­¥éª¤">MCU æ¥å…¥ Difftest æ­¥éª¤</h2>
<ol type="1">
<li><p><strong><u>ç¼–è¯‘ NEMU ä½œä¸ºå‚è€ƒå¯¹è±¡</u></strong>ï¼Œå³ Golden
Modelã€‚NEMU æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„æ¨¡æ‹Ÿå™¨ï¼Œæ”¯æŒ x86/mips32/riscv32/riscv64 ç­‰
ISA</p>
<ul>
<li>å…‹éš† NEMU çš„ GitHub ä»“åº“åˆ°æœ¬åœ°</li>
<li>åœ¨ç¼–è¯‘ NEMU ä¹‹å‰éœ€è¦æŒ‡å®šæƒ³è¦æ¨¡æ‹Ÿçš„ ISAï¼ˆå› ä¸º NEMU æ”¯æŒå¤šç§
ISAï¼‰ï¼š<code>make menuconfig</code> <img
src="https://s2.loli.net/2023/06/29/JiOsqDT7Gh8opdf.png" /></li>
<li>åœ¨ NEMU ç›®å½•ä¸‹ä½¿ç”¨<code>make</code>å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œå¾—åˆ°
nemu-interpreter-so åŠ¨æ€é“¾æ¥æ–‡ä»¶ï¼Œ è¯¥æ–‡ä»¶ä¼šåœ¨ Difftest ç¼–è¯‘æ—¶è¢«å¼•ç”¨</li>
</ul></li>
<li><p>åœ¨ <u><strong>MCU Core ä¸­ä¾‹åŒ– Difftest æ¨¡å—</strong></u></p>
<ol type="1">
<li><p>ä¸º Difftest æµ‹è¯•åˆ›å»ºå¦‚ä¸‹çš„ç›®å½•ç»“æ„ <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DifftestFramework</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”œâ”€â”€ nemu</span><br><span class="line">â””â”€â”€ NOOP</span><br><span class="line">    â”œâ”€â”€ difftest</span><br><span class="line">Â Â   â””â”€â”€ CPU</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Core.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Decode.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Execution.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ InstFetch.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Instructions.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ Ram.v</span><br><span class="line">Â Â   Â Â  â”œâ”€â”€ RegFile.v</span><br><span class="line">Â Â   Â Â  â””â”€â”€ SimTop.v</span><br></pre></td></tr></table></figure></p>
<ul>
<li>bin: æµ‹è¯•æ–‡ä»¶</li>
<li>nemu: æŒ‡ä»¤é›†æ¨¡æ‹Ÿå™¨ï¼Œç”¨äºä½œä¸ºæ¯”è¾ƒçš„ golden model</li>
<li>difftest: é¦™å±±å›¢é˜Ÿæä¾›çš„ difftest æ¡†æ¶</li>
<li>CPU: å­˜æ”¾ MCU_core å®ç°åŠ SimTop
<ul>
<li>Core.v: MCU_core
æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é‡Œä¾‹åŒ–äº†å„ä¸ªæµæ°´çº¿éƒ¨ä»¶ã€<strong>difftest
é‡Œçš„ç»„ä»¶</strong>(å°†å¯¹åº”çš„ä¿¡å·ä¼ é€’ç»™ difftest)</li>
<li>SimTop.vï¼šdifftest æ¡†æ¶é»˜è®¤çš„é¡¶å±‚æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œéœ€è¦ä¾‹åŒ–
MCU_core</li>
<li></li>
</ul></li>
</ul></li>
<li><p>åœ¨ MCU_core é‡Œä¾‹åŒ–å„çº§æµæ°´çº¿æ¨¡å—ä»¥åŠ Difftest æ¨¡å—</p>
<blockquote>
<p>æ•°æ®æµä¼ é€’æ–¹å‘å¯ç®€å•åœ°è®¤ä¸ºæ˜¯
<code>MCU_core.v</code>-&gt;<code>difftest.v</code>-&gt;<code>interface.h</code>-&gt;<code>difftest.cpp</code></p>
</blockquote>
<ul>
<li>difftest.v ä¸­å®šä¹‰äº†æ‰€æœ‰ dpic ç›¸å…³çš„ verilog module ä¿¡æ¯ï¼Œ è¿™äº›
module ä¸­ä¼šè°ƒç”¨ c å‡½æ•°ç”¨æ¥ä¼ è¾“ä¿¡å·ã€‚è¿™äº› module
ä¼šè¢«è®¾è®¡æ ¸å®ä¾‹åŒ–ç”¨æ¥ä¼ è¾“ä¿¡å·ã€‚</li>
<li>mycpu_top.v ä¸­å®ä¾‹åŒ–äº† difftest.v ä¸­å®šä¹‰çš„ moduleã€‚</li>
<li>interface.h æ˜¯ c å‡½æ•°çš„å®ç°ï¼Œc å‡½æ•°å°†è®¾è®¡æ ¸çš„ä¿¡å·èµ‹å€¼ç»™ difftest
ä¸­çš„å˜é‡ã€‚</li>
</ul>
<p><u>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å°†ä»¥ verilog ç¼–å†™çš„ MCU_core é“¾æ¥å…¥ Difftest
æ¡†æ¶</u>ï¼š</p>
<ol type="1">
<li>å‚è€ƒé¾™èŠ¯å›¢é˜Ÿ<a
target="_blank" rel="noopener" href="https://chiplab.readthedocs.io/zh/latest/Simulation/difftest.html">chiplab
å¼€æºé¡¹ç›®ä¸­æ¥å…¥ Difftest</a> çš„æ–‡æ¡£ã€‚
<ul>
<li>é¾™èŠ¯å›¢é˜Ÿé‡‡ç”¨çš„æ˜¯ verilog æ¥ç¼–å†™å…¶ SoC</li>
<li>å¤„ç†å™¨æ”¯æŒçš„æŒ‡ä»¤é›†å…¶ longarchï¼Œå› æ­¤ä»–ä»¬é‡æ„äº† NEMU ä»¥æ”¯æŒ longarch
ISA</li>
<li>ä»–ä»¬æ¥å…¥ difftest æ—¶ç›´æ¥æœ‰ç°æˆçš„ difftest.v æ–‡ä»¶å¯ä»¥ä¾‹åŒ–</li>
<li>å…¶ç»™å‡ºçš„ Difftest Demo å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šå…‹éš†ä¸‹æ¥å¹¶ä¸”è·‘é€š</li>
</ul></li>
<li>å‚è€ƒä¸€ç”Ÿä¸€èŠ¯å›¢é˜Ÿç»™å‡ºçš„ Difftest ç›¸å…³æ•™ç¨‹ã€NEMU ç›¸å…³æ•™ç¨‹
<ul>
<li>YSYX å›¢é˜Ÿæœ€å…ˆæå‡ºåœ¨å¤„ç†å™¨è®¾è®¡ä¸­å¼•å…¥ Difftest æ¡†æ¶</li>
<li>YXYS å›¢é˜Ÿç»™å‡ºäº† NEMUã€ä»¥åŠ Difftest çš„<a
target="_blank" rel="noopener" href="https://ysyx.oscc.cc/docs/ics-pa/0.6.html#git-usage">æºç è§£æ</a></li>
<li>ç›®å‰ YSYX å›¢é˜Ÿæ–‡æ¡£å¤šä»¥ Chisel æ¥å†™ Difftest ä»¥åŠ SoCï¼Œå…¶æ¥å…¥ YSYX
æ¡†æ¶çš„åŸç†æ˜¯ï¼š å…ˆåœ¨ Chisel è¯­è¨€ä¸‹å°†å¤„ç†å™¨æ ¸è·Ÿ Difftest æ¨¡å—é“¾æ¥ï¼Œå†å°†
Chisel ç¼–è¯‘æˆ Verilogï¼Œ åœ¨ Verilog é‡Œç›´æ¥å°±å®ç°äº† Difftest
æ¨¡å—çš„ä¾‹åŒ–ã€‚</li>
<li>è‹¥éœ€è¦åœ¨ YSYX çš„åŸºç¡€ä¸Šè¿›è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¾—åˆ°å…¶ Verilog æ–‡ä»¶ï¼Œ<br />
å†æ¥å…¥ MCU_core:
<code>mill playground.runMain CPU.rv64_1stage.u_simtop</code></li>
</ul></li>
</ol>
<p><img
src="https://s2.loli.net/2023/06/29/JTnzN795uOwBWvQ.png" /></p></li>
<li><p>åœ¨ <strong><u>SimTop.v é‡Œä¾‹åŒ– MCU_core</u></strong>ï¼Œç„¶åé€šè¿‡
Difftest çš„ Makefile æ–‡ä»¶ç¼–è¯‘æ•´ä¸ªå·¥ç¨‹ï¼Œå¯ä»¥å¾—åˆ° emu å¯æ‰§è¡Œæ–‡ä»¶</p>
<ol type="1">
<li>Difftest æ¡†æ¶è§„å®šå¿…é¡»åœ¨ <strong>SimTop</strong> æ–‡ä»¶é‡Œä¾‹åŒ–
MCU_coreï¼Œå› ä¸º Difftest çš„ Makefile é‡Œå†™æ­»äº†</li>
<li>Difftest çš„ Makefile ç¼–è¯‘ä¼šé¦–å…ˆå°† SimTop.v
ç¼–è¯‘æˆ<code>VSimTop.h</code>, <code>VSimTop.cpp</code>ç­‰æ–‡ä»¶ï¼Œ
ä¾›åç»­ç¼–è¯‘ C++æ–‡ä»¶è°ƒç”¨</li>
<li>Difftest ç¼–è¯‘ emu æ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šå¼•ç”¨ VSimTop ç­‰æ–‡ä»¶ä»¥åŠ
nemu-interpreter-so æ–‡ä»¶ã€ä¹Ÿä¼šè½½å…¥ bin æ–‡ä»¶ä»¥åˆå§‹åŒ– I-Memory.</li>
</ol></li>
</ol></li>
</ol>
<h1 id="è¿è¡Œä¸é€šè¿‡ç¨‹åº-abort">è¿è¡Œä¸é€šè¿‡ï¼Œç¨‹åº abort</h1>
<figure>
<img src="https://s2.loli.net/2023/07/01/5cs8iLybhG2EkKN.png"
alt="image-20230701082440062" />
<figcaption aria-hidden="true">image-20230701082440062</figcaption>
</figure>
<p>è¿‡å»ä¸€å‘¨æŒ‰ç…§ YSYX çš„ Difftest æµ‹è¯•æ¡†æ¶ï¼Œé¦–å…ˆç¼–è¯‘ Chisel æ–‡ä»¶å¾—åˆ°äº†
Verilog æ–‡ä»¶ï¼Œç„¶ååœ¨ VSimTop.v æ–‡ä»¶é‡Œï¼Œæ¥å…¥äº†æˆ‘ä»¬çš„ MCU_coreï¼›
ç„¶åæˆåŠŸç¼–è¯‘å‡ºäº† emu å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†æ˜¯<strong>åœ¨æ‰§è¡Œè¯¥ emu
æ–‡ä»¶çš„æ—¶å€™ï¼Œç¨‹åºå¹¶ä¸èƒ½æ­£ç¡®è¿è¡Œ</strong></p>
<p>ç»è¿‡åˆ†æè§‰å¾—å¯èƒ½çš„åŸå› æœ‰å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p>
<ol type="1">
<li><p>SoC Core ç»“æ„ä¸åŒï¼Œæˆ‘ä»¬çš„ I-Memory æ˜¯æ”¾åœ¨ IF å†…éƒ¨çš„ï¼Œ Difftest
demo é‡Œçš„ SoC å…¶ I-Memory æ˜¯æ”¾åœ¨ Core å¤–é¢ï¼Œé€šè¿‡ bus è¯»å–æŒ‡ä»¤çš„ <img
src="https://s2.loli.net/2023/06/30/RE5kzTPf7BGt2iO.png" /></p></li>
<li><p>I-Memory æ¶æ„ä¸åŒï¼Œæˆ‘ä»¬æ˜¯ 2Bankï¼Œdemo æ˜¯ 1-bankï¼Œ å› æ­¤åŠ è½½ bin
æ–‡ä»¶çš„é€»è¾‘ä¸åŒï¼ˆNEMU é€šè¿‡ xx å‡½æ•°è½½å…¥ bin æ–‡ä»¶åˆ°å…¶å†…å­˜ä¸­ï¼‰</p>
<figure>
<img src="https://s2.loli.net/2023/07/01/8Nzq52hxLsHiEPG.png"
alt="image-20230701083353042" />
<figcaption aria-hidden="true">image-20230701083353042</figcaption>
</figure>
<p>NEMU åŠ è½½é•œåƒçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>NMEU ä»<code>init_monitor</code>è¿™ä¸ªå‡½æ•°å¯åŠ¨ï¼Œåœ¨è¯¥å‡½æ•°å†…éƒ¨ï¼š
åˆå§‹åŒ–ä¸€äº› Log ä¿¡æ¯ï¼Œè°ƒè°ƒç”¨ <code>init_mem</code> å‡½æ•°ã€ç”¨
<code>init_isa</code> å‡½æ•°ã€è°ƒç”¨ <code>load_img</code> å‡½æ•°</p></li>
<li><p>init_mem å‡½æ•°ä¸»è¦è´Ÿè´£åŠ è½½é»˜è®¤çš„é•œåƒæ–‡ä»¶åˆ° I-Memory NEMU çš„
I-Memory æœ‰ä¸€å—æ•°ç»„æ¥è¡¨ç¤ºï¼Œinit_mem
å‡½æ•°ä¸»è¦çš„åŠŸèƒ½æ˜¯ç»™è¯¥æ•°ç»„èµ‹å€¼éšæœºæ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// paddr.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> pmem[CONFIG_MSIZE] PG_ALIGN = &#123;&#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">init_mem</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">  srand(time(<span class="number">0</span>));</span><br><span class="line">  <span class="type">uint32_t</span> *p = (<span class="type">uint32_t</span> *)pmem;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; (<span class="type">int</span>) (MEMORY_SIZE / <span class="keyword">sizeof</span>(p[<span class="number">0</span>])); i ++) &#123;</span><br><span class="line">    p[i] = rand();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>init_isa å‡½æ•°ä¸»è¦è´Ÿè´£è½½å…¥é»˜è®¤é•œåƒæ–‡ä»¶åˆ° NEMUï¼Œå¹¶ä¸”åˆå§‹åŒ– pc è·Ÿ x0
å¯„å­˜å™¨ <img
src="https://s2.loli.net/2023/06/29/WeSfnj91rPyiZXu.png" /></p></li>
<li><p>load_img å‡½æ•°çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†é•œåƒæ–‡ä»¶è½½å…¥åˆ° I-Memory å¯ç¤ºä½ç½®</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// image_laoder.c</span></span><br><span class="line"><span class="type">long</span> <span class="title function_">load_img</span><span class="params">(<span class="type">char</span>* img_name, <span class="type">char</span> *which_img, <span class="type">uint64_t</span> load_start, <span class="type">size_t</span> img_size)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    FILE *fp = fopen(loading_img, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    Assert(fp, <span class="string">&quot;Can not open &#x27;%s&#x27;&quot;</span>, loading_img);</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> size;</span><br><span class="line">    fseek(fp, <span class="number">0</span>, SEEK_END);</span><br><span class="line">    size = ftell(fp);</span><br><span class="line">    fseek(fp, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">    <span class="keyword">if</span> (img_size != <span class="number">0</span> &amp;&amp; (size &gt; img_size)) &#123;</span><br><span class="line">     Log(<span class="string">&quot;Warning: size is larger than img_size(upper limit), please check if code is missing. size:%lx img_size:%lx&quot;</span>, size, img_size);</span><br><span class="line">     size = img_size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = fread(guest_to_host(load_start), size, <span class="number">1</span>, fp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// emu.cpp</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(img + (<span class="built_in">strlen</span>(img) - <span class="number">4</span>), <span class="string">&quot;.bin&quot;</span>)) &#123;  <span class="comment">// file extension: .bin</span></span><br><span class="line">      FILE *fp = fopen(img, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (fp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Can not open &#x27;%s&#x27;\n&quot;</span>, img);</span><br><span class="line">          assert(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fseek(fp, <span class="number">0</span>, SEEK_END);</span><br><span class="line">      img_size = ftell(fp);</span><br><span class="line">      <span class="keyword">if</span> (img_size &gt; EMU_RAM_SIZE) &#123;</span><br><span class="line">          img_size = EMU_RAM_SIZE;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fseek(fp, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">      ret = fread(ram, img_size, <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">      assert(ret == <span class="number">1</span>);</span><br><span class="line">      fclose(fp);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>DUT åŠ è½½é•œåƒçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>Emulator æ„é€ å‡½æ•°ä¼šè°ƒç”¨<code>init_mem</code>å‡½æ•°</p>
<figure>
<img src="https://s2.loli.net/2023/07/01/7wnKtoasHJedq6G.png"
alt="image-20230630175159241" />
<figcaption aria-hidden="true">image-20230630175159241</figcaption>
</figure></li>
<li><p><code>init_ram</code>å‡½æ•°ä¼šæŠŠ image bin
æ–‡ä»¶å†…å®¹æ‹·è´åˆ°<code>ram</code>è¿™ä¸ªæŒ‡é’ˆæ‰€æŒ‡ä»£çš„åœ°å€</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ram.cpp</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint64_t</span> *ram;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_ram</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *img)</span> &#123;</span><br><span class="line">  assert(img != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The image is %s\n&quot;</span>, img);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// initialize memory using Linux mmap</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Using simulated %luMB RAM\n&quot;</span>, EMU_RAM_SIZE / (<span class="number">1024</span> * <span class="number">1024</span>));</span><br><span class="line">  ram = (<span class="type">uint64_t</span> *)mmap(<span class="literal">NULL</span>, EMU_RAM_SIZE, PROT_READ | PROT_WRITE, MAP_ANON | MAP_PRIVATE, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (ram == (<span class="type">uint64_t</span> *)MAP_FAILED) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Cound not mmap 0x%lx bytes\n&quot;</span>, EMU_RAM_SIZE);</span><br><span class="line">    assert(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ram.v æ–‡ä»¶ä¼šé€šè¿‡ DPI-C å‡½æ•°åœ¨è®¿é—® ram
æŒ‡é’ˆæ‰€æŒ‡çš„è¿™å—åœ°å€ï¼Œå®ç°<code>dut</code>è¯»å–æŒ‡ä»¤</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ram.v</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;DPI-C&quot;</span> <span class="keyword">function</span> <span class="keyword">void</span> ram_write_helper</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">input</span>  <span class="keyword">longint</span>    wIdx,</span><br><span class="line">  <span class="keyword">input</span>  <span class="keyword">longint</span>    wdata,</span><br><span class="line">  <span class="keyword">input</span>  <span class="keyword">longint</span>    wmask,</span><br><span class="line">  <span class="keyword">input</span>  <span class="keyword">bit</span>        wen</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;DPI-C&quot;</span> <span class="keyword">function</span> <span class="keyword">longint</span> ram_read_helper</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">input</span>  <span class="keyword">bit</span>        en,</span><br><span class="line">  <span class="keyword">input</span>  <span class="keyword">longint</span>    rIdx</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> RAMHelper(</span><br><span class="line">  <span class="keyword">input</span>         clk,</span><br><span class="line">  <span class="keyword">input</span>         en,</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">63</span>:<span class="number">0</span>] rIdx,</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">63</span>:<span class="number">0</span>] rdata,</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">63</span>:<span class="number">0</span>] wIdx,</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">63</span>:<span class="number">0</span>] wdata,</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">63</span>:<span class="number">0</span>] wmask,</span><br><span class="line">  <span class="keyword">input</span>         wen</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assign</span> rdata = ram_read_helper(en, rIdx); <span class="comment">// é€šè¿‡DPI-Cè¯»å–æŒ‡ä»¤</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    ram_write_helper(wIdx, wdata, wmask, wen &amp;&amp; en); <span class="comment">// é€šè¿‡DPI-Cå†™å‡ºæŒ‡ä»¤</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>å¦‚æœéœ€è¦å®Œæˆ MCU_core çš„ I-Memory åˆå§‹åŒ–å·¥ä½œï¼Œéœ€è¦â€œåœ¨ IF Stage çš„
I-Memory æ¨¡å—ä¸­æ·»åŠ  DPI-C æ¥å£â€ï¼Œâ€œæ›´æ”¹ ram.cpp æ–‡ä»¶é‡Œé¢çš„ init_mem
å‡½æ•°ï¼Œä»¥æ”¯æŒ 2-bank ITCMâ€</p>
</blockquote></li>
</ol>
<h1
id="å°†mcu_coreä»‹å…¥diffteståšçš„ä¿®æ”¹">å°†MCU_Coreä»‹å…¥Diffteståšçš„ä¿®æ”¹</h1>
<h2
id="æ”¾å¼ƒä½¿ç”¨é¦™å±±å®˜æ–¹æä¾›çš„æœ€æ–°çš„difftestç‰ˆæœ¬">æ”¾å¼ƒä½¿ç”¨é¦™å±±å®˜æ–¹æä¾›çš„æœ€æ–°çš„Difftestç‰ˆæœ¬</h2>
<p>æ”¾å¼ƒä½¿ç”¨æœ€æ–°ç‰ˆæœ¬Difftestçš„åŸå› å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>é¦™å±±æœ€æ–°ç‰ˆæœ¬çš„Githubä»“åº“é‡ŒDiffteståªæœ‰Scalaçš„ç‰ˆæœ¬ï¼Œæ— æ³•ç›´æ¥åœ¨Verilogä¸­å¼•ç”¨</li>
<li>ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„Difftest<strong>è¿‡äºå¤æ‚</strong>ï¼šå®ƒæ”¯æŒå¤šæ ¸ã€Cacheã€Uartã€Trapç­‰æ¨¡å—ï¼Œå¯¼è‡´ç§»æ¤MCU_Coreåˆ°æœ€æ–°ç‰ˆæœ¬çš„Difftestæ—¶ï¼Œéœ€è¦ä¿è¯è¿™äº›æ¨¡å—éƒ½çœŸç¡®è¿çº¿ï¼Œååˆ†å¤æ‚ã€‚
ä¸€å¼€å§‹å°è¯•æ¥å…¥æœ€æ–°ç‰ˆæœ¬çš„Difftestï¼Œç»“æœè°ƒè¯•äº†ä¸€ä¸¤å¤©è¿˜æ˜¯æŠ¥é”™æ— æ³•çœ‹åˆ°<em>æœ‰è¿›å±•çš„ç»“æœ</em>ï¼Œå› æ­¤é¢„æµ‹å°†MCU_Coreæ¥å…¥åˆ°æœ€æ–°ç‰ˆæœ¬çš„Difftestæ¡†æ¶ä¸­å°†æ¶ˆè€—å¾ˆä¹…çš„æ—¶é—´</li>
<li>ç›®å‰ç”±äºæ²¡æœ‰CSRæ¨¡å—ï¼Œå…¶å®æˆ‘ä»¬çš„MCU_Coreçš„çŠ¶æ€ä»…æœ‰<strong>â€œPC+Registerâ€</strong>è¡¨å¾ï¼Œå› æ­¤Difftestæ¡†æ¶åªéœ€è¦åœ¨æŒ‡ä»¤æäº¤ä¹‹åæ¯”è¾ƒPCè·ŸRegisterå³å¯ã€‚
<u>Difftestæ ¸å¿ƒæ€æƒ³ï¼šMCU_Coreæ‰§è¡Œä¸€æ¡æŒ‡ä»¤-&gt;Reference
Modelæ‰§è¡Œä¸€æ¡æŒ‡ä»¤-&gt;æ¯”è¾ƒäºŒè€…çš„çŠ¶æ€(PC + Register)</u></li>
</ol>
<blockquote>
<p>å› æ­¤é€‰æ‹©äº†â€œçŸ³å³°æä¾›çš„Difftestâ€ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä»–ä¹‹å‰åšYSYXæ—¶æ¥å…¥çš„Difftestï¼Œå…¶å®ç°çš„æ•ˆæœæ˜¯ï¼šå°†ä»–è®¾è®¡çš„å•å‘¨æœŸRISC-Vå¤„ç†å™¨æ¥å…¥åˆ°Difftestæ¡†æ¶ä¸­ï¼Œæ¯”è¾ƒå…¶æ¯æ¬¡æäº¤æŒ‡ä»¤åï¼ŒRegisteræ˜¯å¦è·ŸReference
Modelç›¸åŒï¼Œæ¯”è¾ƒç¬¦åˆæˆ‘ä»¬ç›®å‰çš„æµ‹è¯•éœ€æ±‚ï¼Œæ¥å…¥çš„éš¾åº¦ç›¸å½“äºæ¥å…¥æœ€æ–°ç‰ˆæœ¬çš„Difftestä¹Ÿæ›´åŠ å¯æ§ã€‚</p>
</blockquote>
<h2 id="æ¥å…¥difftestæ¡†æ¶åšçš„ä¿®æ”¹">æ¥å…¥Difftestæ¡†æ¶åšçš„ä¿®æ”¹</h2>
<figure>
<img src="../../../../../../Pictures/typora/image-20230707211721928.png"
alt="image-20230707211721928" />
<figcaption aria-hidden="true">image-20230707211721928</figcaption>
</figure>
<p>ä¸ºäº†å°†MCU_Coreæ¥å…¥åˆ°Difftestæ¡†æ¶ï¼Œä¸»è¦åšäº†å¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<ol type="1">
<li><p>ä¿®æ”¹Verilogä»£ç æ¥å…¥Difftestæ¡†æ¶ä¹‹åçš„Warningï¼Œä¸»è¦åŒ…æ‹¬ä»£ç ä¸­çš„â€œéšå¼å˜é‡å£°æ˜ã€ä¿¡å·ä½å®½ä¸åŒ¹é…ã€æ¨¡å—é‡å®šä¹‰â€ç­‰Warningã€‚å› ä¸ºVerilatorç›¸è¾ƒäºIverilogå¯¹äºè¯­æ³•æ£€æŸ¥æ›´åŠ ä¸¥æ ¼ä¸€äº›ã€‚</p></li>
<li><p>åœ¨top.vä¸­å¢åŠ æ¥å£ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>Difftestæ¡†æ¶éœ€è¦çŸ¥é“MCU_Coreçš„ä¸€äº›å†…éƒ¨ä¿¡å·ï¼Œå¦‚pc, instruction</li>
<li>å°†ä¸€äº›é‡è¦çš„ä¿¡å·ä»topå¼•å‡ºæ¥ï¼Œå¯ä»¥åœ¨Difftestçš„æ—¶å€™è¿›è¡Œæ‰“å°ï¼Œæ–¹ä¾¿åˆ¤æ–­</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mcu_core/top.v</span></span><br><span class="line"><span class="keyword">module</span> top(</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span>        resetn,</span><br><span class="line">    <span class="comment">// signals used by difftest</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] pc,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">63</span>:<span class="number">0</span>] instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span>        wb_en,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [ <span class="number">4</span>:<span class="number">0</span>] wb_idx,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] wb_data,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] id_instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">20</span>:<span class="number">0</span>] op_code,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] src1,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] src2,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [ <span class="number">3</span>:<span class="number">0</span>] wb_src,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] alu_result</span><br><span class="line">    <span class="comment">// signals used by difftest</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// difftest/csrc/cpu_exec.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">execute</span><span class="params">(<span class="type">uint64_t</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (;n &gt; <span class="number">0</span>; n --) &#123;</span><br><span class="line">    g_nr_guest_inst ++;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Top: instr = 0x%x\n&quot;</span>, top-&gt;instr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ID Stage: id_instr=0x%x, opcode = %d, src1 = 0x%x, src2 = 0x%x, wb_src= %d\n&quot;</span>, top-&gt;id_instr, top-&gt;op_code, top-&gt;src1, top-&gt;src2, top-&gt;wb_src);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;EXE stage: alu_result = 0x%x\n&quot;</span>, top-&gt;alu_result);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;WB Stage: wb_en=%d, idx=%d, data=%x\n&quot;</span>, top-&gt;wb_en,</span><br><span class="line">           top-&gt;wb_idx, top-&gt;wb_data);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Difftestä»¿çœŸè¾“å‡º</span></span><br><span class="line">Top: instr = 0x413</span><br><span class="line">ID Stage: id_instr=0x413, opcode = 1, src1 = 0x0, src2 = 0x0, wb_src= 1</span><br><span class="line">EXE stage: alu_result = 0x0</span><br><span class="line">WB Stage: wb_en=0, idx=0, data=0</span><br><span class="line">npc <span class="built_in">read</span> instr</span><br><span class="line">Read I-Memory: addr = 0x80000004, ins= 0x00009117</span><br><span class="line">NO.2-&gt; pc: 0x80000004, instr: 0x9117, asm: auipc        sp, 9</span><br><span class="line">NO.2-&gt; pc: 0x80000004, instr: 0x9117, asm: auipc        sp, 9</span><br><span class="line">C-&gt; pmem_read 80000000: 0x0</span><br><span class="line">Read I-Memory: addr = 0x80000000, ins= 0x00000413</span><br><span class="line">pmem_read_rtl: raddr = 0x80000000, rdata= 413</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨topçš„æ¥å£ä¸­å®šä¹‰äº†ä¸€äº›ä¿¡å·ï¼Œæˆ‘ä»¬åœ¨Difftestæ¡†æ¶ä¸­å°±å¯ä»¥æ‰“å°ç›¸åº”çš„ä¿¡å·å€¼</p></li>
<li><p>ç¡®å®šMCU_Coreæäº¤åˆ°difftest çš„æ—¶æœº</p>
<ul>
<li>ç”±äºReference
Modelæ˜¯å•å‘¨æœŸçš„å¤„ç†å™¨ï¼Œå…¶æ¯ä¸ªCycleå°±ä¼šæäº¤ä¸€æ¡æŒ‡ä»¤ï¼›æˆ‘ä»¬çš„MCU_Coreæ˜¯5çº§æµæ°´çº¿å¤„ç†å™¨ï¼Œç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»ç­‰åˆ°5ä¸ªCycleä¹‹åå…¶ç»“æœæ‰ä¼šå†™å…¥åˆ°Register</li>
<li>æˆ‘ä»¬çš„MCUç”±äºåˆ†æ”¯é¢„æµ‹å™¨çš„å­˜åœ¨ï¼Œå¯èƒ½ä¼šå–ä¸€æ¡æŒ‡ä»¤ï¼Œä½†æ˜¯è¿™æ¡æŒ‡ä»¤ä¼šè¢«å†²åˆ·ï¼Œå› æ­¤å…¶ä¸ä¼šå†™å…¥åˆ°Register</li>
</ul>
<p>å¯è§<strong>MCU_Coreä¸­çš„æŒ‡ä»¤ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªCycleéƒ½ä¼šå†™å…¥åˆ°Registerï¼Œä½†æ˜¯Reference
Modelä¸€æ—¦æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œåˆ™ä¼šåœ¨ä¸€ä¸ªCycleå†™å…¥åˆ°Register</strong>ï¼Œå› æ­¤ï¼š</p>
<ul>
<li>MCU_Coreå¿…é¡»å‘Šè¯‰Difftestæ¡†æ¶ï¼Œå…¶åœ¨æŸæ—¶åˆ»å†™å…¥åˆ°äº†Register</li>
<li>Difftestæ¡†æ¶åœ¨æ”¶åˆ°è¯¥ä¿¡å·ä¹‹åï¼Œä»¤Reference
Modelæ‰§è¡Œä¸€æ­¥ï¼Œå¹¶ä¸”å°†å…¶ç»“æœå†™å…¥åˆ°Register</li>
</ul>
<p>ç»è¿‡åˆ†æå‘ç°ï¼Œæˆ‘ä»¬çš„MCU_Coreä¸è®ºæŒ‡ä»¤æµæ˜¯ä½•ç§æƒ…å†µï¼Œå…¶åœ¨å†™å…¥Registerçš„æ—¶å€™ï¼Œéƒ½ä¼šæœ‰wb_enä¿¡å·ä¸ºé«˜ï¼Œå› æ­¤<strong>æˆ‘ä»¬åœ¨topä¸­åŠ å…¥è¯¥ä¿¡å·ï¼Œå¹¶ä¸”åœ¨Difftestä¸­æ ¹æ®è¯¥ä¿¡å·æ¥æ§åˆ¶Reference
Modelæ‰§è¡Œå’ŒDifftestæ¯”è¾ƒ</strong>ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// difftest/csrc/cpu_exec.c</span></span><br><span class="line"><span class="comment">/* difftest begin */</span></span><br><span class="line">cpu.pc = top-&gt;pc; <span class="comment">// pcå­˜å…¥cpuç»“æ„ä½“</span></span><br><span class="line">dump_gpr(); <span class="comment">// å¯„å­˜å™¨å€¼å­˜å…¥cpuç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">if</span>(top-&gt;wb_en)&#123; <span class="comment">// &lt;- åˆ¤æ–­æŒ‡ä»¤æäº¤å†è¿›å…¥Difftest</span></span><br><span class="line">    difftest_step(top-&gt;pc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* difftest end */</span></span><br></pre></td></tr></table></figure></li>
<li><p>åœ¨I-Memoryä¸­å¢åŠ DPI-Cå‡½æ•°å®ç°I-Memoryåˆå§‹åŒ–</p>
<ul>
<li>ä¸åŒäºç”¨verilogå†™çš„testbenchï¼ŒDifftestæ¡†æ¶é‡Œåˆå§‹åŒ–éƒ½æ˜¯é€šè¿‡cå‡½æ•°æ¥å°†ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶è¯»å…¥å†…å­˜çš„ã€‚
<ul>
<li>åœ¨Difftestä»£ç é‡Œï¼Œå®šä¹‰äº†ä¸€å—å†…å­˜<code>pmem</code>ç”¨äºå­˜å‚¨MCU_Coreçš„æŒ‡ä»¤</li>
<li>é€šè¿‡load_imgå‡½æ•°æ¥åˆå§‹åŒ–pmemï¼Œå®ç°I-Memoryçš„åˆå§‹åŒ–ï¼›åœ¨verilogå†™çš„testbenchä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡readmemhå‡½æ•°æ¥è¯»å…¥äºŒè¿›åˆ¶æ–‡ä»¶åˆ°å†…å­˜çš„</li>
<li>åœ¨verilogæ–‡ä»¶ä¸­ï¼Œ<strong>æŒ‡ä»¤çš„è¯»å–æ˜¯é€šè¿‡DPI-Cå‡½æ•°ï¼Œè¯»å–<code>pmem</code>å¯¹åº”åœ°å€çš„å€¼</strong>ï¼›åœ¨verilogå†™çš„testbenchä¸­ï¼ŒæŒ‡ä»¤çš„è¯»å–æ˜¯ç›´æ¥é€šè¿‡<code>assign instr = i-memory[addr];</code>æ¥å®ç°çš„</li>
</ul></li>
</ul>
<figure>
<img src="https://s2.loli.net/2023/07/07/adIbS1DR5uxBA4r.png"
alt="image-20230707211024214" />
<figcaption aria-hidden="true">image-20230707211024214</figcaption>
</figure></li>
<li><p>åœ¨Registerä¸­å¢åŠ DPI-Cå‡½æ•°å°†CPUçš„registerä¼ é€’ç»™Difftestæ¨¡å—</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;DPI-C&quot;</span> <span class="keyword">function</span> <span class="keyword">void</span> set_gpr_ptr(<span class="keyword">input</span> <span class="keyword">logic</span> [<span class="number">63</span>:<span class="number">0</span>] a []); <span class="comment">// add DPI-C function</span></span><br><span class="line"><span class="keyword">module</span> regfile</span><br><span class="line">    (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span>                              clk_i,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span>                              resetn_i,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span>    [REG_DATA_WIDTH-<span class="number">1</span> :<span class="number">0</span>]     rs1_data_o, <span class="comment">// rd1</span></span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    );</span><br><span class="line">	<span class="comment">//.....</span></span><br><span class="line">    <span class="comment">// regfileå…¶ä½™éƒ¨åˆ†å‡ä¿æŒä¸å˜å³å¯</span></span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> set_gpr_ptr(regfile_data); <span class="comment">// &lt;- ä½¿ç”¨è¯¥DPI-Cå‡½æ•°å°†mcu_coreçš„registerçŠ¶æ€ä¼ é€’ç»™Difftestæ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<figure>
<img src="https://s2.loli.net/2023/07/07/hjYRv8Ps32GOZTV.png"
alt="image-20230707210809687" />
<figcaption aria-hidden="true">image-20230707210809687</figcaption>
</figure></li>
</ol>
<h2 id="mcu_coreæ¥å…¥difftestç»“æœ">MCU_Coreæ¥å…¥Difftestç»“æœ</h2>
<figure>
<img src="https://s2.loli.net/2023/07/07/QD8nlf1BTNMxYGo.png"
alt="image-20230707210706875" />
<figcaption aria-hidden="true">image-20230707210706875</figcaption>
</figure>
<p>ç›®å‰MCU_Coreå·²ç»æ¥å…¥åˆ°äº†Difftestæ¡†æ¶ï¼ŒDifftestæ£€æµ‹åˆ°MCU_Coreè¿è¡Œçš„ç»“æœè·ŸReference
Modelçš„ç»“æœä¸åŒï¼Œä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ç»™å‡ºæŠ¥é”™çš„ä¿¡æ¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>
<ol type="1">
<li><p>åç»­ä¼šé™†ç»­æ ¹æ®Difftestçš„æç¤ºï¼Œé™†ç»­ä¿®æ”¹MCU_Coreä¸­çš„bugï¼Œç›´åˆ°é€šè¿‡æ‰€æœ‰çš„æµ‹è¯•ï¼Œè¾¾åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºæ•ˆæœï¼Œå‡ºç°<code>HIT GOOD TRAP</code>å­—æ ·ï¼š</p>
<figure>
<img src="https://s2.loli.net/2023/07/07/nmXbVy69HxjOtwJ.png"
alt="image-20230707210602556" />
<figcaption aria-hidden="true">image-20230707210602556</figcaption>
</figure></li>
<li><p>ä¹Ÿä¼šé¢„å…ˆç ”ç©¶å¦‚ä½•åœ¨Difftestä¸­æµ‹è¯•ä¸€äº›å¤æ‚äº‹ä»¶çš„æ¯”è¾ƒï¼Œä¾‹å¦‚Trapã€CSRæ¯”è¾ƒ</p></li>
</ol>
<h2 id="references">References</h2>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/232088281">RISC-V åŠ RISC-V
core compliance test ç®€æ</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/lowRISC/riscv-compliance/blob/master/doc/README.adocintroduction">RISC-V
Compliance Tests</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/riscv-ovpsim/imperas-riscv-tests">Imperas Test
Suit</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/riscv-non-isa/riscv-arch-test">riscv-arch-test</a></li>
<li><a
target="_blank" rel="noopener" href="https://alvinalexander.com/scala/mill-build-tool/step-1-hello-world/">mill
é…ç½®æ•™ç¨‹</a></li>
<li><a
target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs250/sp17/handouts/chisel-tutorial.pdf">chisel3
åŸºç¡€çŸ¥è¯†</a></li>
<li><a
target="_blank" rel="noopener" href="https://inst.eecs.berkeley.edu/~cs250/sp17/handouts/advanced-chisel.pdf">chisel3
é«˜çº§è¯­æ³•</a></li>
<li><a
target="_blank" rel="noopener" href="http://www.icfgblog.com/index.php/software/341.html#comment-61">ğŸŒŸDifftest
è¸©å‘ç¬”è®°(äºŒ)</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OSCPU/ysyx/issues/9">ğŸŒŸVerilog
ä»£ç æ¥å…¥åˆ° Difftest</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OSCPU/ysyx/issues/8">ğŸŒŸChisel æ¥å…¥
difftest çš„å‡ ä¸ªä¸»è¦æ­¥éª¤</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/OpenXiangShan/difftest/blob/master/doc/usage.md">ğŸŒŸDifftest
ä½¿ç”¨æŒ‡å—</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OSCPU/ysyx/issues/10">difftest
è®¿å­˜è¸©å‘åˆ†äº«</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OSCPU/ysyx/issues/13">Difftest å’Œ NEMU
çš„ç‰ˆæœ¬å¯¹åº”å…³ç³»</a></li>
<li><a target="_blank" rel="noopener" href="https://chiplab.readthedocs.io/zh/latest/">ğŸŒŸchiplab's
documentation</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/RISC-V/" rel="tag"># RISC-V</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/05/15/interview-notes/" rel="prev" title="é¢è¯•ç¬”è®°">
                  <i class="fa fa-chevron-left"></i> é¢è¯•ç¬”è®°
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/05/16/memory-notes/" rel="next" title="è®¡ç®—æœºå†…å­˜">
                  è®¡ç®—æœºå†…å­˜ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FuJie</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">438k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">6:38</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
